(()=>{let e;(()=>{const t="__app_hrp",r="production",n=!1;if(e=globalThis[t],e)return;const i={name:t,env:r,get:e=>e in i?i[e]:null,...JSON.parse('{"version":"11.4.0"}')},o=function e(t){const r=t===i,s=r&&n,o={},c=e=>Object.assign(t,e),h=new Proxy(t,{get(n,i){if("assign"===i)return c;if(r&&!String(i).startsWith("$"))return t[i];if(!(i in t)){if(t[i]={},r){const e=a.bind(null,"log",i,!1),r=a.bind(null,"log",i,!0),n=a.bind(null,"warn",i,!1),s=a.bind(null,"warn",i,!0),o=a.bind(null,"error",i,!1),c=a.bind(null,"error",i,!0),h=l.bind(null,i);Object.defineProperties(t[i],{log:{get:()=>e},logDev:{get:()=>r},warn:{get:()=>n},warnDev:{get:()=>s},error:{get:()=>o},errorDev:{get:()=>c},Error:{get:()=>h}})}o[i]=e(t[i]),s&&(globalThis[i]=t[i])}return i in o?o[i]:t[i]},set:(e,r,n)=>(t[r]=n,o[r]=n,s&&(globalThis[r]=t[r]),!0)});return h}(i);function a(e,t,r,...n){if(r)return;const[i,o,a]=function(e){let t=0;e.split("").forEach(((r,n)=>{t=e.charCodeAt(n)+((t<<5)-t)}));return[(16711680&t)>>16,(65280&t)>>8,255&t]}(t);s[e](`%c[${t}]`,`color: rgb(${i}, ${o}, ${a})`,...n)}function l(e,t,...r){return r.length>0&&a("error",e,!1,t,...r),new Error(`[${e}] ${t}`)}globalThis[t]=o,e=o})();const t=e=>{const t=globalThis.__hrp_globals||{},r={},n=(e,t)=>"function"==typeof t&&/^[a-z]/.test(e);return new Proxy(e,{get(i,s){let o=t[s]||e[s];return n(s,o)&&(r[s]??=o.bind(e),o=r[s]),o},set:(t,i,s)=>(e[i]=s,n(i,s)&&(r[i]=s.bind(e)),!0)})},r=e=>{try{return n[e]}catch{return globalThis[e]}},n=t(globalThis),i=globalThis.top===globalThis?n:t(globalThis.top),s=r("logger")||r("console"),o=(r("Audio"),r("Blob")),a=(r("CSSStyleSheet"),r("CanvasRenderingContext2D"),r("CustomEvent"),r("DOMParser"),r("Event"),r("File"),r("FileReader")),l=(r("HTMLAnchorElement"),r("HTMLElement"),r("HTMLImageElement"),r("HTMLVideoElement"),r("Headers"),r("Image"),r("IntersectionObserver"),r("MouseEvent"),r("MutationObserver")),c=r("Node"),h=r("NodeFilter"),m=r("NodeList"),u=r("Request"),d=(r("ResizeObserver"),r("Response"),r("SVGElement")),p=r("URL"),f=(r("WebSocket"),r("Worker"),r("XMLHttpRequest")),g=r("XMLSerializer"),y=r("XPathResult"),b=(r("alert"),r("atob")),_=r("btoa"),v=(r("chrome"),r("clearInterval"),r("clearTimeout")),w=r("document"),E=r("fetch"),T=r("getComputedStyle"),x=(r("getSelection"),r("history"),r("indexedDB"),r("location")),S=r("navigator"),A=(r("parent"),r("requestAnimationFrame")),N=(r("screen"),r("setInterval"),r("setTimeout"));let C=null;try{C=r("localStorage")}catch{}let P=null;try{P=r("sessionStorage")}catch{}(()=>{const{$utils:t}=e;t.canvasToBlob=async(e,t="image/webp",r=.9)=>await new Promise(((n,i)=>{try{e.toBlob((t=>{t?n(t):0===e.width||0===e.height?i("canvas.toBlob failed, canvas has no dimensions"):i("canvas.toBlob failed")}),t,r)}catch(e){i(e)}}))})(),(()=>{const{$utils:t}=e;t.clamp=(e,t,r)=>Math.min(Math.max(e,t),r)})(),(()=>{const{$utils:t}=e;function r(e,t,n,i){if(i&&(e=i(e)),!e)return e;if("object"!=typeof e)return e;let s,o=Array.isArray(e)?[]:{};for(const a in e)e.hasOwnProperty&&!e.hasOwnProperty(a)||(s=e[a],t.has(s)?n.push({clone:o,key:a,value:s}):(t.set(s,!0),o[a]=r(s,t,n,i),t.set(s,o[a])));return o}t.cloneDeep=(e,t=null,n=!1)=>{if(!t&&globalThis.structuredClone&&!n&&!Array.isArray(e))return structuredClone(e);const i=new Map,s=[],o=r(e,i,s,t);return s.forEach((({clone:e,key:t,value:r})=>{e[t]=i.get(r)})),o}})(),(()=>{const{$utils:t}=e,r=[{name:"US Dollar",symbol:"$",symbolNative:"$",code:"USD",namePlural:"US dollars",alt:["US$","US $"]},{name:"Canadian Dollar",symbol:"CA$",symbolNative:"$",code:"CAD",namePlural:"Canadian dollars",alt:["CA $","CAN$","CAN $","C$"]},{name:"Euro",symbol:"€",symbolNative:"€",code:"EUR",namePlural:"euros"},{name:"United Arab Emirates Dirham",symbol:"AED",symbolNative:"د.إ.‏",code:"AED",namePlural:"UAE dirhams"},{name:"Afghan Afghani",symbol:"Af",symbolNative:"؋",code:"AFN",namePlural:"Afghan Afghanis"},{name:"Albanian Lek",symbol:"ALL",symbolNative:"Lek",code:"ALL",namePlural:"Albanian lekë"},{name:"Armenian Dram",symbol:"AMD",symbolNative:"դր.",code:"AMD",namePlural:"Armenian drams"},{name:"Argentine Peso",symbol:"AR$",symbolNative:"$",code:"ARS",namePlural:"Argentine pesos",alt:["AR $"]},{name:"Australian Dollar",symbol:"AU$",symbolNative:"$",code:"AUD",namePlural:"Australian dollars",alt:["AU $"]},{name:"Azerbaijani Manat",symbol:"₼",symbolNative:"ман.",code:"AZN",namePlural:"Azerbaijani manats"},{name:"Bosnia-Herzegovina Convertible Mark",symbol:"KM",symbolNative:"KM",code:"BAM",namePlural:"Bosnia-Herzegovina convertible marks"},{name:"Bangladeshi Taka",symbol:"Tk",symbolNative:"৳",code:"BDT",namePlural:"Bangladeshi takas"},{name:"Bulgarian Lev",symbol:"BGN",symbolNative:"лв.",code:"BGN",namePlural:"Bulgarian leva"},{name:"Bahraini Dinar",symbol:"BD",symbolNative:"د.ب.‏",code:"BHD",namePlural:"Bahraini dinars"},{name:"Burundian Franc",symbol:"FBu",symbolNative:"FBu",code:"BIF",namePlural:"Burundian francs"},{name:"Brunei Dollar",symbol:"BN$",symbolNative:"$",code:"BND",namePlural:"Brunei dollars",alt:["BN $"]},{name:"Bolivian Boliviano",symbol:"Bs",symbolNative:"Bs",code:"BOB",namePlural:"Bolivian bolivianos"},{name:"Brazilian Real",symbol:"R$",symbolNative:"R$",code:"BRL",namePlural:"Brazilian reals"},{name:"Botswanan Pula",symbol:"BWP",symbolNative:"P",code:"BWP",namePlural:"Botswanan pulas"},{name:"Belarusian Ruble",symbol:"Br",symbolNative:"руб.",code:"BYN",namePlural:"Belarusian rubles"},{name:"Belize Dollar",symbol:"BZ$",symbolNative:"$",code:"BZD",namePlural:"Belize dollars",alt:["BZ $"]},{name:"Congolese Franc",symbol:"CDF",symbolNative:"FrCD",code:"CDF",namePlural:"Congolese francs"},{name:"Swiss Franc",symbol:"CHF",symbolNative:"CHF",code:"CHF",namePlural:"Swiss francs"},{name:"Chilean Peso",symbol:"CL$",symbolNative:"$",code:"CLP",namePlural:"Chilean pesos",alt:["CL $"]},{name:"Chinese Yuan",symbol:"CN¥",symbolNative:"CN¥",code:"CNY",namePlural:"Chinese yuan"},{name:"Colombian Peso",symbol:"CO$",symbolNative:"$",code:"COP",namePlural:"Colombian pesos",alt:["CO $"]},{name:"Costa Rican Colón",symbol:"₡",symbolNative:"₡",code:"CRC",namePlural:"Costa Rican colóns"},{name:"Cape Verdean Escudo",symbol:"CV$",symbolNative:"CV$",code:"CVE",namePlural:"Cape Verdean escudos",alt:["CV $"]},{name:"Czech Republic Koruna",symbol:"Kč",symbolNative:"Kč",code:"CZK",namePlural:"Czech Republic korunas"},{name:"Djiboutian Franc",symbol:"Fdj",symbolNative:"Fdj",code:"DJF",namePlural:"Djiboutian francs"},{name:"Danish Krone",symbol:"Dkr",symbolNative:"kr",code:"DKK",namePlural:"Danish kroner"},{name:"Dominican Peso",symbol:"RD$",symbolNative:"RD$",code:"DOP",namePlural:"Dominican pesos",alt:["RD $"]},{name:"Algerian Dinar",symbol:"DA",symbolNative:"د.ج.‏",code:"DZD",namePlural:"Algerian dinars"},{name:"Estonian Kroon",symbol:"Ekr",symbolNative:"kr",code:"EEK",namePlural:"Estonian kroons"},{name:"Egyptian Pound",symbol:"EGP",symbolNative:"ج.م.‏",code:"EGP",namePlural:"Egyptian pounds"},{name:"Eritrean Nakfa",symbol:"Nfk",symbolNative:"Nfk",code:"ERN",namePlural:"Eritrean nakfas"},{name:"Ethiopian Birr",symbol:"Br",symbolNative:"Br",code:"ETB",namePlural:"Ethiopian birrs"},{name:"British Pound Sterling",symbol:"£",symbolNative:"£",code:"GBP",namePlural:"British pounds sterling"},{name:"Georgian Lari",symbol:"GEL",symbolNative:"GEL",code:"GEL",namePlural:"Georgian laris"},{name:"Ghanaian Cedi",symbol:"GH₵",symbolNative:"GH₵",code:"GHS",namePlural:"Ghanaian cedis"},{name:"Guinean Franc",symbol:"FG",symbolNative:"FG",code:"GNF",namePlural:"Guinean francs"},{name:"Guatemalan Quetzal",symbol:"GTQ",symbolNative:"Q",code:"GTQ",namePlural:"Guatemalan quetzals"},{name:"Hong Kong Dollar",symbol:"HK$",symbolNative:"$",code:"HKD",namePlural:"Hong Kong dollars",alt:["HK $"]},{name:"Honduran Lempira",symbol:"HNL",symbolNative:"L",code:"HNL",namePlural:"Honduran lempiras"},{name:"Croatian Kuna",symbol:"kn",symbolNative:"kn",code:"HRK",namePlural:"Croatian kunas"},{name:"Hungarian Forint",symbol:"Ft",symbolNative:"Ft",code:"HUF",namePlural:"Hungarian forints"},{name:"Indonesian Rupiah",symbol:"Rp",symbolNative:"Rp",code:"IDR",namePlural:"Indonesian rupiahs"},{name:"Israeli New Sheqel",symbol:"₪",symbolNative:"₪",code:"ILS",namePlural:"Israeli new sheqels"},{name:"Indian Rupee",symbol:"Rs",symbolNative:"টকা",code:"INR",namePlural:"Indian rupees"},{name:"Iraqi Dinar",symbol:"IQD",symbolNative:"د.ع.‏",code:"IQD",namePlural:"Iraqi dinars"},{name:"Iranian Rial",symbol:"IRR",symbolNative:"﷼",code:"IRR",namePlural:"Iranian rials"},{name:"Icelandic Króna",symbol:"Ikr",symbolNative:"kr",code:"ISK",namePlural:"Icelandic krónur"},{name:"Jamaican Dollar",symbol:"J$",symbolNative:"$",code:"JMD",namePlural:"Jamaican dollars"},{name:"Jordanian Dinar",symbol:"JD",symbolNative:"د.أ.‏",code:"JOD",namePlural:"Jordanian dinars"},{name:"Japanese Yen",symbol:"¥",symbolNative:"￥",code:"JPY",namePlural:"Japanese yen"},{name:"Kenyan Shilling",symbol:"Ksh",symbolNative:"Ksh",code:"KES",namePlural:"Kenyan shillings"},{name:"Cambodian Riel",symbol:"KHR",symbolNative:"៛",code:"KHR",namePlural:"Cambodian riels"},{name:"Comorian Franc",symbol:"CF",symbolNative:"FC",code:"KMF",namePlural:"Comorian francs"},{name:"South Korean Won",symbol:"₩",symbolNative:"₩",code:"KRW",namePlural:"South Korean won"},{name:"Kuwaiti Dinar",symbol:"KD",symbolNative:"د.ك.‏",code:"KWD",namePlural:"Kuwaiti dinars"},{name:"Kazakhstani Tenge",symbol:"KZT",symbolNative:"тңг.",code:"KZT",namePlural:"Kazakhstani tenges"},{name:"Lebanese Pound",symbol:"LB£",symbolNative:"ل.ل.‏",code:"LBP",namePlural:"Lebanese pounds"},{name:"Sri Lankan Rupee",symbol:"SLRs",symbolNative:"SL Re",code:"LKR",namePlural:"Sri Lankan rupees"},{name:"Lithuanian Litas",symbol:"Lt",symbolNative:"Lt",code:"LTL",namePlural:"Lithuanian litai"},{name:"Libyan Dinar",symbol:"LD",symbolNative:"د.ل.‏",code:"LYD",namePlural:"Libyan dinars"},{name:"Moroccan Dirham",symbol:"MAD",symbolNative:"د.م.‏",code:"MAD",namePlural:"Moroccan dirhams"},{name:"Moldovan Leu",symbol:"MDL",symbolNative:"MDL",code:"MDL",namePlural:"Moldovan lei"},{name:"Malagasy Ariary",symbol:"MGA",symbolNative:"MGA",code:"MGA",namePlural:"Malagasy Ariaries"},{name:"Macedonian Denar",symbol:"MKD",symbolNative:"MKD",code:"MKD",namePlural:"Macedonian denari"},{name:"Myanma Kyat",symbol:"MMK",symbolNative:"K",code:"MMK",namePlural:"Myanma kyats"},{name:"Macanese Pataca",symbol:"MOP$",symbolNative:"MOP$",code:"MOP",namePlural:"Macanese patacas",alt:["MOP $"]},{name:"Mauritian Rupee",symbol:"MURs",symbolNative:"MURs",code:"MUR",namePlural:"Mauritian rupees"},{name:"Mexican Peso",symbol:"MX$",symbolNative:"$",code:"MXN",namePlural:"Mexican pesos",alt:["MX $"]},{name:"Malaysian Ringgit",symbol:"RM",symbolNative:"RM",code:"MYR",namePlural:"Malaysian ringgits"},{name:"Mozambican Metical",symbol:"MTn",symbolNative:"MTn",code:"MZN",namePlural:"Mozambican meticals"},{name:"Namibian Dollar",symbol:"N$",symbolNative:"N$",code:"NAD",namePlural:"Namibian dollars"},{name:"Nigerian Naira",symbol:"₦",symbolNative:"₦",code:"NGN",namePlural:"Nigerian nairas"},{name:"Nicaraguan Córdoba",symbol:"C$",symbolNative:"C$",code:"NIO",namePlural:"Nicaraguan córdobas"},{name:"Norwegian Krone",symbol:"Nkr",symbolNative:"kr",code:"NOK",namePlural:"Norwegian kroner"},{name:"Nepalese Rupee",symbol:"NPRs",symbolNative:"नेरू",code:"NPR",namePlural:"Nepalese rupees"},{name:"New Zealand Dollar",symbol:"NZ$",symbolNative:"$",code:"NZD",namePlural:"New Zealand dollars",alt:["NZ $"]},{name:"Omani Rial",symbol:"OMR",symbolNative:"ر.ع.‏",code:"OMR",namePlural:"Omani rials"},{name:"Panamanian Balboa",symbol:"B/.",symbolNative:"B/.",code:"PAB",namePlural:"Panamanian balboas"},{name:"Peruvian Nuevo Sol",symbol:"S/.",symbolNative:"S/.",code:"PEN",namePlural:"Peruvian nuevos soles"},{name:"Philippine Peso",symbol:"₱",symbolNative:"₱",code:"PHP",namePlural:"Philippine pesos"},{name:"Pakistani Rupee",symbol:"PKRs",symbolNative:"₨",code:"PKR",namePlural:"Pakistani rupees"},{name:"Polish Zloty",symbol:"zł",symbolNative:"zł",code:"PLN",namePlural:"Polish zlotys"},{name:"Paraguayan Guarani",symbol:"₲",symbolNative:"₲",code:"PYG",namePlural:"Paraguayan guaranis"},{name:"Qatari Rial",symbol:"QR",symbolNative:"ر.ق.‏",code:"QAR",namePlural:"Qatari rials"},{name:"Romanian Leu",symbol:"RON",symbolNative:"RON",code:"RON",namePlural:"Romanian lei"},{name:"Serbian Dinar",symbol:"din.",symbolNative:"дин.",code:"RSD",namePlural:"Serbian dinars"},{name:"Russian Ruble",symbol:"RUB",symbolNative:"₽.",code:"RUB",namePlural:"Russian rubles"},{name:"Rwandan Franc",symbol:"RWF",symbolNative:"FR",code:"RWF",namePlural:"Rwandan francs"},{name:"Saudi Riyal",symbol:"SR",symbolNative:"ر.س.‏",code:"SAR",namePlural:"Saudi riyals"},{name:"Sudanese Pound",symbol:"SDG",symbolNative:"SDG",code:"SDG",namePlural:"Sudanese pounds"},{name:"Swedish Krona",symbol:"Skr",symbolNative:"kr",code:"SEK",namePlural:"Swedish kronor"},{name:"Singapore Dollar",symbol:"S$",symbolNative:"$",code:"SGD",namePlural:"Singapore dollars"},{name:"Somali Shilling",symbol:"Ssh",symbolNative:"Ssh",code:"SOS",namePlural:"Somali shillings"},{name:"Syrian Pound",symbol:"SY£",symbolNative:"ل.س.‏",code:"SYP",namePlural:"Syrian pounds"},{name:"Thai Baht",symbol:"฿",symbolNative:"฿",code:"THB",namePlural:"Thai baht"},{name:"Tunisian Dinar",symbol:"DT",symbolNative:"د.ت.‏",code:"TND",namePlural:"Tunisian dinars"},{name:"Tongan Paʻanga",symbol:"T$",symbolNative:"T$",code:"TOP",namePlural:"Tongan paʻanga",alt:["T $"]},{name:"Turkish Lira",symbol:"₺",symbolNative:"₺",code:"TRY",namePlural:"Turkish Lira"},{name:"Trinidad and Tobago Dollar",symbol:"TT$",symbolNative:"$",code:"TTD",namePlural:"Trinidad and Tobago dollars",alt:["TT $"]},{name:"New Taiwan Dollar",symbol:"NT$",symbolNative:"NT$",code:"TWD",namePlural:"New Taiwan dollars",alt:["NT $"]},{name:"Tanzanian Shilling",symbol:"TSh",symbolNative:"TSh",code:"TZS",namePlural:"Tanzanian shillings"},{name:"Ukrainian Hryvnia",symbol:"₴",symbolNative:"₴",code:"UAH",namePlural:"Ukrainian hryvnias"},{name:"Ugandan Shilling",symbol:"USh",symbolNative:"USh",code:"UGX",namePlural:"Ugandan shillings"},{name:"Uruguayan Peso",symbol:"$U",symbolNative:"$",code:"UYU",namePlural:"Uruguayan pesos"},{name:"Uzbekistan Som",symbol:"UZS",symbolNative:"UZS",code:"UZS",namePlural:"Uzbekistan som"},{name:"Venezuelan Bolívar",symbol:"Bs.F.",symbolNative:"Bs.F.",code:"VEF",namePlural:"Venezuelan bolívars"},{name:"Vietnamese Dong",symbol:"₫",symbolNative:"₫",code:"VND",namePlural:"Vietnamese dong"},{name:"CFA Franc BEAC",symbol:"FCFA",symbolNative:"FCFA",code:"XAF",namePlural:"CFA francs BEAC"},{name:"CFA Franc BCEAO",symbol:"CFA",symbolNative:"CFA",code:"XOF",namePlural:"CFA francs BCEAO"},{name:"Yemeni Rial",symbol:"YR",symbolNative:"ر.ي.‏",code:"YER",namePlural:"Yemeni rials"},{name:"South African Rand",symbol:"R",symbolNative:"R",code:"ZAR",namePlural:"South African rand"},{name:"Zambian Kwacha",symbol:"ZK",symbolNative:"ZK",code:"ZMK",namePlural:"Zambian kwachas"},{name:"Zimbabwean Dollar",symbol:"ZWL$",symbolNative:"ZWL$",code:"ZWL",namePlural:"Zimbabwean Dollar",alt:["ZWL $"]}],n={};r.forEach((e=>{const t=e.symbolNative;t.endsWith(".")&&(e.symbolNative=t.slice(0,-1)),n[e.code]=e}));t.currency={list:r,byCode:n,formatCurrency:(e,r="name")=>{const n=e.indexOf(":"),i=-1===n?e:e.slice(n+1);return t.currency.byCode[i]?.[r]||e}}})(),(()=>{const{$utils:t}=e;t.ensureArray=e=>Array.isArray(e)?e:[e]})(),(()=>{const{$utils:t}=e;t.extractor={extract(e){this.init();const t=this._cache.get(e);if(t)return t;let r={value:e,template:null,items:[]};return e?(r.value.match(/\d/)&&(r=this._parseTime(r),r=this._parseDuration(r),r=this._parseCopyright(r),r=this._parseDate(r,this.config.regex.date_triplex,!0),r=this._parseDate(r,this.config.regex.date_dmy,!0),r=this._parseDate(r,this.config.regex.date_mdy,!0),r=this._parseDate(r,this.config.regex.date_my,!0),r.value=e,r=this._parseNumber(r),r=this._mergeNumbers(r),r=this._cleanSourceMetrics(r)),this._maskItemsInValue(r),r=this._parseCurrency(r),this._maskItemsInValue(r,"currency"),r.template=this._replaceMask(r.value),r.value=e,r.items=r.items.sort(((e,t)=>e.index-t.index)),this._cache.set(e,r),r):(this._cache.set(e,r),r)},config:{currencies:t.currency.list,time:{millisecond:1,second:1e3,minute:6e4,hour:36e5},monthsMap:{},currenciesMap:{},metricsMap:{"μs":{to:"ms",mult:.001},microsecond:{to:"ms",mult:.001},microseconds:{to:"ms",mult:.001},ms:{to:"ms",mult:1},millisecond:{to:"ms",mult:1},milliseconds:{to:"ms",mult:1},s:{to:"ms",mult:1e3},second:{to:"ms",mult:1e3},seconds:{to:"ms",mult:1e3},m:{to:"ms",mult:6e4},min:{to:"ms",mult:6e4},minute:{to:"ms",mult:6e4},minutes:{to:"ms",mult:6e4},h:{to:"ms",mult:36e5},hour:{to:"ms",mult:36e5},hours:{to:"ms",mult:36e5},d:{to:"ms",mult:864e5},day:{to:"ms",mult:864e5},days:{to:"ms",mult:864e5},w:{to:"ms",mult:6048e5},week:{to:"ms",mult:6048e5},weeks:{to:"ms",mult:6048e5},mo:{to:"ms",mult:2592e6},month:{to:"ms",mult:2592e6},months:{to:"ms",mult:2592e6},y:{to:"ms",mult:31536e6},year:{to:"ms",mult:31536e6},years:{to:"ms",mult:31536e6},"μm":{to:"meters",mult:1e-6},micrometre:{to:"meters",mult:1e-6},micrometer:{to:"meters",mult:1e-6},micrometres:{to:"meters",mult:1e-6},micrometers:{to:"meters",mult:1e-6},mm:{to:"meters",mult:.001},millimetre:{to:"meters",mult:.001},millimeter:{to:"meters",mult:.001},millimetres:{to:"meters",mult:.001},millimeters:{to:"meters",mult:.001},cm:{to:"meters",mult:.01},centimetre:{to:"meters",mult:.01},centimeter:{to:"meters",mult:.01},centimetres:{to:"meters",mult:.01},centimeters:{to:"meters",mult:.01},dm:{to:"meters",mult:.1},decimetre:{to:"meters",mult:.01},decimeter:{to:"meters",mult:.01},decimetres:{to:"meters",mult:.01},decimeters:{to:"meters",mult:.01},metre:{to:"meters",mult:1},metres:{to:"meters",mult:1},meter:{to:"meters",mult:1},meters:{to:"meters",mult:1},km:{to:"meters",mult:1e3},kilometre:{to:"meters",mult:1e3},kilometer:{to:"meters",mult:1e3},kilometres:{to:"meters",mult:1e3},kilometers:{to:"meters",mult:1e3},inch:{to:"meters",mult:.0254},inches:{to:"meters",mult:.0254},foot:{to:"meters",mult:.3048},feet:{to:"meters",mult:.3048},yard:{to:"meters",mult:.9144},yards:{to:"meters",mult:.9144},mile:{to:"meters",mult:1609.344},miles:{to:"meters",mult:1609.344},"μg":{to:"grams",mult:1e-6},microgram:{to:"grams",mult:1e-6},micrograms:{to:"grams",mult:1e-6},mg:{to:"grams",mult:.001},milligram:{to:"grams",mult:.001},milligrams:{to:"grams",mult:.001},g:{to:"grams",mult:1},gram:{to:"grams",mult:1},grams:{to:"grams",mult:1},kg:{to:"grams",mult:1e3},kilogram:{to:"grams",mult:1e3},kilograms:{to:"grams",mult:1e3},tonne:{to:"grams",mult:1e6},tonnes:{to:"grams",mult:1e6},oz:{to:"grams",mult:28.349523125},ounce:{to:"grams",mult:28.349523125},ounces:{to:"grams",mult:28.349523125},lb:{to:"grams",mult:453.59237},pound:{to:"grams",mult:453.59237},pounds:{to:"grams",mult:453.59237},byte:{to:"bytes",mult:1},bytes:{to:"bytes",mult:1},kb:{to:"bytes",mult:1e3},kilobyte:{to:"bytes",mult:1e3},kilobytes:{to:"bytes",mult:1e3},mb:{to:"bytes",mult:1e6},megabyte:{to:"bytes",mult:1e6},megabytes:{to:"bytes",mult:1e6},gb:{to:"bytes",mult:1e9},gigabyte:{to:"bytes",mult:1e9},gigabytes:{to:"bytes",mult:1e9},tb:{to:"bytes",mult:1e12},terabyte:{to:"bytes",mult:1e12},terabytes:{to:"bytes",mult:1e12},pb:{to:"bytes",mult:1e15},petabyte:{to:"bytes",mult:1e15},petabytes:{to:"bytes",mult:1e15},"%":{to:"%",mult:1},percent:{to:"%",mult:1}},regex:{delimiter:/^(,\s|,|\s| and )$/gi,number:/LA(?<content>(?:(?<currency>CURRENCY)\s?)?(?<sign>>|~|\+|±|-|\+-|-\+)?(?<value>(?<integer>\d+(?:(?: \d\d\d)*|(?:,\d\d\d)*|(?:\.\d\d\d)*))(?<decimal>[,.]\d+)?(?<multiplier>(k|m|b|t| ?thousands?| ?millions?| ?billions?| ?trillions?)(?!\w))?\+?)(?:[ -]?(?<metric>METRIC|CURRENCY))?)LB/gim,time:/LA(?<content>((?<hours>\d?\d):)?(?<minutes>\d?\d):(?<seconds>\d\d)(?:.(?<ms>\d?\d?\d))?\s*(?<ampm>am|pm|a\.m\.|p\.m\.)?)LB/gim,duration:/LA(?<content>(?:(?<hours>\d+):)?(?<minutes>\d?\d):(?<seconds>\d\d)(?:.(?<ms>\d?\d?\d))?)LB/gim,copyright:/LA(?<content>(?:©|\(c\))\s(?<year>(\d\d)?\d\d))LB/gim,date_triplex:/LA(?<content>(?<date>\d?\d)(?<sep1>[/.])(?<month>\d?\d)((?<sep2>[/.])(?<year>(\d?\d?\d\d)))?)LB/gim,date_dmy:/LA(?<content>(?<date>\d?\d)(?:st|nd|rd|th)?(?:[ -]| of )(?<month>MONTH)((, |,| |-)(?<year>\d?\d?\d\d)?)?)LB/gim,date_mdy:/LA(?<content>(?<month>MONTH)(?: |-| the )(?<date>\d?\d)(?:st|nd|rd|th)?((?:, |,| |-)(?<year>\d?\d?\d\d)?)?)LB/gim,date_my:/LA(?<content>(?<month>MONTH)((?:, |,| |-| of )(?<year>\d?\d?\d\d)))LB/gim,currency:/LA(?<content>CURRENCY)LB/gim}},init(){this._initialized||(this._initialized=!0,this._cache=new Map,this._maskCache=[],this._enrichConfigWithMonths(),this._enrichConfigWithCurrencies(),this._enrichRegexes("LA",/(?<=^|\s|\w-|\w\/|"|'|\()/),this._enrichRegexes("LB",/(?=\/\w|°|-\w|\s|\W\s|\W$|\)|$)/),this._parseNumber=this._createRegexParser(this._parseNumber,this.config.regex.number),this._parseTime=this._createRegexParser(this._parseTime,this.config.regex.time),this._parseDuration=this._createRegexParser(this._parseDuration,this.config.regex.duration),this._parseCopyright=this._createRegexParser(this._parseCopyright,this.config.regex.copyright),this._parseDate=this._createRegexParser(this._parseDate,this.config.regex.date_triplex),this._parseCurrency=this._createRegexParser(this._parseCurrency,this.config.regex.currency))},_enrichConfigWithMonths(){let e=["en"];if(globalThis.navigator){const t=S.languages;t&&e.push(...t)}if(globalThis.document?.documentElement){const t=w.documentElement.getAttribute("lang");t&&e.push(t)}let t=[];e=Array.from(new Set(e)),e.forEach((e=>{try{[...this._getMonthList(e,"short"),...this._getMonthList(e,"long")].forEach(((e,r)=>{e=e.toLowerCase(),void 0===this.config.monthsMap[e]&&(this.config.monthsMap[e]=r%12,t.push(e))}))}catch{}})),t=t.join("|"),this._enrichRegexes("MONTH",t)},_enrichConfigWithCurrencies(){let e=["$","USD","kr"],t="all,lvl,try,top,bob,pen,php,af,fc,fr,bs,km,rm,qr,tl,ft,jd,k,r,p,l,q";t=new Set(t.split(",")),this.config.currenciesMap={$:"USD",USD:"USD",kr:"SEK"};const r=(r,n)=>{this.config.currenciesMap[r]||t.has(r)||(this.config.currenciesMap[r]=n,e.push(r))};this.config.currencies.forEach((e=>{r(e.code.toLowerCase(),e.code),r(e.name.toLowerCase(),e.code),r(e.namePlural.toLowerCase(),e.code),r(e.symbol.toLowerCase(),e.code),r(e.symbolNative.toLowerCase(),e.code),(e.alt||[]).forEach((t=>r(t.toLowerCase(),e.code)))})),e=e.map((e=>e.replace("$","\\$").replace(".","\\."))).join("|"),this._enrichRegexes("CURRENCY",e);const n=Object.keys(this.config.metricsMap).join("|");this._enrichRegexes("METRIC",n)},_enrichRegexes(e,t){"[object regexp]"===Object.prototype.toString.call(t).toLowerCase()&&(t=t.source),Object.keys(this.config.regex).forEach((r=>{this.config.regex[r].source.includes(e)&&(this.config.regex[r]=new RegExp(this.config.regex[r].source.replaceAll(e,t),this.config.regex[r].flags))}))},_getMonthList:(e="en",t="long")=>"auto"===e?[]:Array.from(Array(12).keys(),(r=>Intl.DateTimeFormat(e,{month:{s:"short",n:"numeric"}[t[0]]||"long"}).format(new Date(0,r)))),_createRegexParser(e,t){const r=t;return function({value:t,items:n},i,s=!1){const o=Array.from(t.matchAll(i||r)).filter((e=>e.groups));return 0===o.length?arguments[0]:(o.forEach((r=>{let i=e(r,this.config);i&&(i=Array.isArray(i)?i:[i],0!==i.length&&(i.forEach((e=>{e.hasOwnProperty("content")||(e.content=r.groups.content),e.hasOwnProperty("index")||(e.index=r.index)})),n=[...n,...i],s&&(t=this._replaceMatch(t,r))))})),{value:t,items:n})}},_replaceMatch(e,t,r="#"){const n=t.groups.content,i=t.index+t.input.slice(t.index).indexOf(n),s=e.slice(0,i),o=e.slice(i+n.length);return s+r.repeat(n.length)+o},_parseTime(e,t){let r=Number(e.groups.hours),n=Number(e.groups.minutes),i=Number(e.groups.seconds);const s=e.groups.ms?1e3*Number("0."+e.groups.ms):0;Number.isNaN(r)&&(r=n,n=i,i=0);const o=(e.groups.ampm||"").toLowerCase().replaceAll(/\./g,"").trim();return o&&r>12?null:("am"===o?12===r&&(r=0):"pm"===o&&r<12&&(r+=12),{type:"time",value:s*t.time.millisecond+i*t.time.second+n*t.time.minute+r*t.time.hour,content:e.groups.content,index:e.index})},_parseDuration(e,t){const r=Number(e.groups.hours)||0,n=Number(e.groups.minutes)||0,i=Number(e.groups.seconds)||0;return{type:"number",value:(e.groups.ms?1e3*Number("0."+e.groups.ms):0)*t.time.millisecond+i*t.time.second+n*t.time.minute+r*t.time.hour,metric:"ms"}},_parseCopyright(e){const t=Number(e.groups.year);return Number.isNaN(t)?null:{type:"copyright",value:t}},_parseDate(e,t){if(e.groups.sep1&&e.groups.sep2&&e.groups.sep1!==e.groups.sep2)return null;let r=e.groups.date?Number(e.groups.date):1,n=e.groups.month;if(e.groups.sep1)"/"===e.groups.sep1&&([n,r]=[r,n]),n>12&&([n,r]=[r,n]),n-=1;else if(n=t.monthsMap[e.groups.month.toLowerCase()],void 0===n)return null;if(Number.isNaN(r)||r<1||r>31)return null;if(Number.isNaN(n)||n<0||n>11)return null;let i=Number(e.groups.year||(new Date).getFullYear());if(i<100){const e=(new Date).getFullYear();i=Number(e.toString().slice(0,2)+i),i>e&&(i-=100)}const s=new Date(Date.UTC(i,n,r));return{type:"date",value:s.getTime(),date:s}},_parseNumber(e,t){let{integer:r,decimal:n,sign:i,multiplier:s,currency:o,metric:a}=e.groups;o=o&&o.toLowerCase(),a=a&&a.toLowerCase(),n=n||"";const l={type:"number"},c=[l];if(4===n.length&&r.length<4&&(r+=n,n=""),!n.startsWith(",")||4!==n.length||r.includes(".")||r.includes(" ")||(r+=n,n=""),r=r.replaceAll(/[ ,.]/g,""),n=n.replaceAll(/[ ,.]/g,"."),l.value=Number(r+n),"-"===i&&(l.value*=-1),s=s?s.toLowerCase():s||"","k"===s||s.includes("thousand")?l.value*=1e3:"m"===s||s.includes("million")?l.value*=1e6:"b"===s||s.includes("billion")?l.value*=1e9:("t"===s||s.includes("trillion"))&&(l.value*=1e12),l.value=parseFloat(l.value.toFixed(6)),(o||a)&&(l.metric=o||a),"m"===s&&!a&&l.value%1e6==0){const e={...l};e.value/=1e6,e.metric="minutes",c.push(e);const t={...l};t.value/=1e6,t.metric="meters",c.push(t)}return c.filter((e=>e.metric)).forEach((e=>{const r=e.metric;t.currenciesMap[r]?(e.type="price",e.sourceMetric=r,e.metric="CUR:"+t.currenciesMap[r]):(e.sourceMetric=r,e.metric=t.metricsMap[r].to,e.value=e.value*t.metricsMap[r].mult)})),c},_mergeNumbers(e){if(e.items.length<2)return e;let t=!1;const r={};return e.items.forEach(((e,n)=>{e.metric&&"number"!==!e.type&&(r[e.metric]=r[e.metric]||[],r[e.metric].push({item:e,index:n}),r[e.metric].length>1&&(t=!0))})),t?(Object.values(r).forEach((t=>{let r=[];const n=()=>{if(r.length<2)r=[];else for(let t=1;t<r.length;t++){const n=r[t],i=r[t-1];e.items[r[0].index].value+=n.item.value,e.items[r[0].index].content=e.items[r[0].index].content+e.value.substring(i.item.index+i.item.content.length,n.item.index)+n.item.content,e.items[n.index]=null}};r.push(t[0]);for(let i=1;i<t.length;i++){const s=t[i-1],o=t[i];s.item.sourceMetric!==o.item.sourceMetric&&this.config.metricsMap[s.item.sourceMetric]?.mult>this.config.metricsMap[o.item.sourceMetric]?.mult&&e.value.substring(s.item.index+s.item.content.length,o.item.index).match(this.config.regex.delimiter)?r.push(o):(n(),r.push(o))}n()})),e.items=e.items.filter((e=>Boolean(e))),e):e},_cleanSourceMetrics:e=>(e.items.forEach((e=>{e.sourceMetric&&delete e.sourceMetric})),e),_parseCurrency(e,t){const{content:r}=e.groups;return{type:"currency",value:"CUR:"+t.currenciesMap[r.toLowerCase()]}},_maskItemsInValue(e,t=null){let r=e.value,n=e.items;if(t&&(n=n.filter((e=>e.type===t))),0===n.length)return r.trim();n.forEach((e=>{const t=r.slice(0,e.index),n=r.slice(e.index+e.content.length);let i=this._maskCache[e.content.length];i||(i="҉".repeat(e.content.length),this._maskCache[e.content.length]=i),r=t+i+n})),e.value=r},_replaceMask:(e,t="{{data}}")=>e.replace(/҉+/gi,t).trim()}})(),(()=>{const{$utils:t}=e;t.hashCode=e=>{if("string"!=typeof e)throw new Error("$utils.hashCode source parameter must be a string");if(0===e.length)return 0;let t,r=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n),r=(r<<5)-r+t,r|=0;return r}})(),(()=>{const{$utils:t}=e;t.mutation={addedNodes:e=>{const t=new Set,r=e=>{if(!t.has(e)){t.add(e);for(const t of e.childNodes)r(t)}};for(const t of e)for(const e of t.addedNodes)r(e);return Array.from(t)},addedElements:e=>{const t=new Set,r=e=>{if(e.nodeType===Element.ELEMENT_NODE&&!t.has(e)){t.add(e);for(const t of e.children)r(t)}};for(const t of e)for(const e of t.addedNodes)r(e);return Array.from(t)},removedNodes:e=>{const t=new Set,r=e=>{if(!t.has(e)){t.add(e);for(const t of e.childNodes)r(t)}};for(const t of e)for(const e of t.removedNodes)r(e);return Array.from(t)},removedElements:e=>{const t=new Set,r=e=>{if(e.nodeType===Element.ELEMENT_NODE&&!t.has(e)){t.add(e);for(const t of e.children)r(t)}};for(const t of e)for(const e of t.removedNodes)r(e);return Array.from(t)},on:(e,t,r)=>{if(!r&&(r=t,t=e,e=null,!r&&(r=t,t=null,!r)))throw new Error("$utils.mutation.on listener must be specified");if(e=e||w.documentElement,"string"==typeof(t=t||{childList:!0,subtree:!0}))t={[t]:!0};else if(Array.isArray(t)){const e={};t.forEach((t=>e[t]=!0)),t=e}const n=new l(r);return n.observe(e,t),n},off:e=>{e.disconnect()}}})(),(()=>{const{$utils:t}=e;t.noThrow=(e,t=null)=>{if(!e)return;let r;try{r=e()}catch{r=t}return r instanceof Promise?new Promise((async e=>{try{r=await r}catch{r=t}e(r)})):r}})(),(()=>{const{$utils:t}=e;t.occurrences={regex:(e,r)=>("string"==typeof r&&(r=r.split("\n")),0===(r=t.ensureArray(r)).length?0:(r=r.map((e=>t.string.toRegex(e))).filter((e=>!!e))).reduce(((t,r)=>t+(e.match(r)||[]).length),0)),string(e,t,r=!1){if(t.length<=0)return e.length+1;let n=0,i=0,s=r?1:t.length;for(;i=e.indexOf(t,i),i>=0;)++n,i+=s;return n}}})(),(()=>{const{$utils:t}=e;t.raf=async(e=1)=>{0!==e&&(await new Promise((e=>A(e))),await t.raf(e-1))}})(),(()=>{const{$utils:t}=e,r=Symbol("running");t.singleExecution=(e,t=null)=>async(...n)=>{if(!e[r]){e[r]=!0;try{return await e.call(t,...n)}catch(e){throw e}finally{delete e[r]}}}})(),(()=>{const{$utils:t}=e,r=(e,t="-_",r=!1)=>{let n=String(e);return r||(n=n.replace(/(\p{Ll})(\p{Lu})/gu,"$1-$2")),n.toLowerCase().replace(new RegExp(`[${t}]+`,"g")," ").trim().replaceAll(" ","-")},n=e=>{if(null==e)return e;return("string"!=typeof e?String(e):e).length>0?`${e[0].toLowerCase()}${e.substring(1)}`:""},i=e=>{if(null==e)return e;return("string"!=typeof e?String(e):e).replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")};t.string={shorten:(e,t=40,r="",n="…")=>{if(null==e)return r;const i="string"!=typeof e?String(e):e;return i.length>t?i.slice(0,t)+n:i},toSentenceCase:e=>{if(null==e)return e;let t="string"!=typeof e?String(e):e;return t=t.replace(/(^|[.!?]\s*)([a-z])/g,((e,t,r)=>t+r.toUpperCase())),t},toTitleCase:e=>{if(null==e)return e;let t="string"!=typeof e?String(e):e;return t=t.replace(/(^|\s)([a-z])/g,((e,t,r)=>t+r.toUpperCase())),t},toPascalCase:(e,t=" -_")=>{if(null==e)return e;t=i(t);const r=new RegExp(`[${t}]+`,"g");let n="string"!=typeof e?String(e):e;return n=n.split(r).map((e=>e[0].toUpperCase()+e.slice(1))).join(""),n},toCamelCase:(e,t=" -_")=>{if(null==e)return e;t=i(t);const r=new RegExp(`[${t}]+`,"g");let s="string"!=typeof e?String(e):e;return s=s.split(r).map((e=>e[0].toUpperCase()+e.slice(1))).join(""),s=n(s),s},toKebabCase:r,toSlugCase:(e,{encode:t=!0}={})=>{let n=String(e);return n=r(n.replaceAll(".","")),t&&(n=encodeURIComponent(n)),n},toUnderscoreCase:(e,t="-_",r=!1)=>{let n=String(e);return r||(n=n.replace(/(\p{Ll})(\p{Lu})/gu,"$1-$2")),n.toLowerCase().replace(new RegExp(`[${t}]+`,"g")," ").trim().replaceAll(" ","_")},toCapitalFirst:e=>{if(null==e)return e;return("string"!=typeof e?String(e):e).length>0?`${e[0].toUpperCase()}${e.substring(1)}`:""},toLowerFirst:n,containsInMiddle:(e,t)=>{const r=e.indexOf(t);return-1!==r&&0!==r&&r!==e.length-t.length},escapeRegExp:i,toRegex:(e,t="gi")=>{if(null==e)return e;if(e instanceof RegExp)return e;if("string"!=typeof e||0===e.length)return null;if(e.startsWith("/")&&-1!==e.indexOf("/",2))try{const t=e.replace(/.*\/([gimy]*)$/,"$1"),r=e.replace(new RegExp("^/(.*?)/"+t+"$"),"$1");return RegExp(r,t)}catch(e){}return e=i(e),new RegExp(e,t)},incrementNumberSuffix:e=>{if(null==e)return e;const t="string"!=typeof e?String(e):e;let r=t.match(/ #(\d+)$/)||t.match(/ (\d+)$/);if(!r)return`${t} #2`;const n=Number(r[1])||1,i=r[0].includes("#")?"#":"";return`${t.slice(0,r.index)} ${i}${n+1}`},empty:e=>0===e.trim().length,rotate:(e,t=1)=>{const r=e.length;return t>0?e.substring(t,r)+e.substring(0,t):e.substring(r+t,r)+e.substring(0,r+t)},abbreviationCheck:(e,t,r=30)=>{e=e.toLowerCase().substring(0,r);const n=(t=t.toLowerCase()).split(" "),i=e.split(" ");e:{for(const e of i)if(!n.find((t=>t.startsWith(e))))break e;return!0}e=e.replaceAll(" ","");let s=0;for(const t of n)for(const r of t){if(e[s]!==r)break;if(s++,s>=e.length)return!0}return s>=e.length},random:(e=50)=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let r="";for(let n=0;n<e;n++)r+=t[Math.floor(Math.random()*t.length)];return r}}})(),(()=>{const{$utils:t}=e,r=Symbol("original-styles");t.style={override(e,t,n){e[r]??=[],e[r].push({key:t,value:e.style.getPropertyValue(t),priority:e.style.getPropertyPriority(t)}),e.style.setProperty(t,n,"important")},reset(e){(e[r]||[]).forEach((t=>e.style.setProperty(t.key,t.value,t.priority))),delete e[r]}}})(),(()=>{const{$capture:t,$bus:r,$utils:i,$startup:s}=e;t.controller={init(){i.isTopFrame()&&(this._handlers=[],this._selectArea=i.singleExecution(this._selectArea,this),r.on("capture.selectArea",this._selectArea,this))},async _selectArea(e){e||="Click and drag to select area";s.controller.getRootElement().insertAdjacentHTML("beforeend",this._render(e));const t=w.documentElement,r=w.querySelector(".HrpCapture"),o=w.querySelector(".HrpCapture__box"),a=w.querySelector(".HrpCapture__hint"),l=i.createPromise();let c,h,m,u,d=!1,p=!1;const f=async e=>{this._off(),r.remove(),i.style.reset(t),await i.sleep(20),l.resolve(e)},g=(e=1)=>[c,h,m,u].some(i.is.nil)||c===m||h===u?null:{x:Math.min(c,m)*e,y:Math.min(h,u)*e,width:Math.abs(c-m)*e,height:Math.abs(h-u)*e},y=()=>{const e=g();o.style.left=e?`${e.x}px`:null,o.style.top=e?`${e.y}px`:null,o.style.width=e?`${e.width}px`:null,o.style.height=e?`${e.height}px`:null};return this._on(w,"mousedown",(e=>{p||(d=!0,c=m=e.clientX,h=u=e.clientY,i.style.override(t,"overflow","hidden"))})),this._on(w,"mousemove",(e=>{(e=>{let t=e.clientX-32,r=e.clientY+24;const i=n.innerWidth-a.offsetWidth-8;t<8&&(t=8),t>i&&(t=i),r>n.innerHeight-a.offsetHeight&&(r=e.clientY-24-a.offsetHeight),a.style.left=`${t}px`,a.style.top=`${r}px`,a.style.opacity=d||p?0:1})(e),d&&(m=i.clamp(0,e.clientX,n.innerWidth),u=i.clamp(0,e.clientY,n.innerHeight),y())})),this._on(w,"mouseup",(()=>{const e=n.devicePixelRatio,t=g(e);t?f(t):d=!1})),this._on(w,"keydown",(e=>{"Escape"===e.key?f(null):"Shift"!==e.key||d||(p=!0,c=4,h=4,m=n.innerWidth-4,u=n.innerHeight-4,y())})),this._on(w,"keyup",(e=>{"Shift"!==e.key||d||(p=!1,c=null,h=null,m=null,u=null,y())})),this._on(w,"contextmenu",(e=>{f(null)})),await l},_on(e,t,r){this._handlers.push({target:e,name:t,fn:r}),e.addEventListener(t,r)},_off(){this._handlers.forEach((e=>e.target.removeEventListener(e.name,e.fn)))},_render:e=>`<div class=HrpCapture><div class=HrpCapture__box></div><div class=HrpCapture__hint>${e}</div></div>`}})(),(()=>{const{$engine:t}=e;function r(e){let t=e.parentNode;for(;t;){if("TABLE"===t.nodeName)return(t.getAttribute("role")||"").split(" ").includes("grid");t=t.parentNode}return!1}t.tagsToRoles={A:e=>e.hasAttribute("href")?"link":null,AREA:e=>e.hasAttribute("href")?"link":null,ARTICLE:"article",ASIDE:"complementary",BUTTON:"button",DATALIST:"listbox",DD:"definition",DFN:"term",DETAILS:"group",DIALOG:"dialog",DT:"term",FIELDSET:"group",FIGURE:"figure",FOOTER:e=>{const r=["ARTICLE","ASIDE","MAIN","NAV","SECTION"],n=["article","complementary","main","navigation","region"];let i=e.parentElement;for(;i;){if(r.includes(i.nodeName))return null;if(n.includes(t.inspector.role(i)))return null;i=i.parentElement}return"contentinfo"},FORM:"form",H1:"heading",H2:"heading",H3:"heading",H4:"heading",H5:"heading",H6:"heading",HEADER:e=>{const r=["ARTICLE","ASIDE","MAIN","NAV","SECTION"],n=["article","complementary","main","navigation","region"];let i=e.parentElement;for(;i&&i!==w.documentElement;){if(r.includes(i.nodeName))return null;if(n.includes(t.inspector.role(i)))return null;i=i.parentElement}return"banner"},HR:"separator",HTML:"document",IMG:e=>""===e.getAttribute("alt")?"presentation":"img",INPUT:e=>{const t=e.getAttribute("type");return e.hasAttribute("list")&&[null,"text","search","tel","url","email"].includes(t)?"combobox":"button"===t?"button":"checkbox"===t?"checkbox":"email"===t?"textbox":"image"===t?"button":"number"===t?"spinbutton":"radio"===t?"radio":"range"===t?"slider":"reset"===t?"button":"search"===t?"searchbox":"submit"===t?"button":"tel"===t||"text"===t||"url"===t?"textbox":null},LI:"listitem",MAIN:"main",MATH:"math",MENU:"list",NAV:"navigation",OL:"list",OPTGROUP:"group",OPTION:"option",OUTPUT:"status",PROGRESS:"progressbar",SECTION:"region",SELECT:e=>e.hasAttribute("multiple")||Number(e.getAttribute("size"))>1?"listbox":"combobox",SUMMARY:"button",SVG:"graphics-document",TABLE:"table",TBODY:"rowgroup",TEXTAREA:"textbox",TFOOT:"rowgroup",THEAD:"rowgroup",TD:e=>r(e)?"gridcell":"cell",TH:e=>{const t=r(e)?"gridcell":"cell";return`${"row"===e.getAttribute("scope")?"rowheader":"columnheader"} ${t}`},TR:"row",UL:"list"}})(),(()=>{const{$engine:t}=e;t.crawler={init(){if(n.top!==n.self)try{let e=n.name.match(/__hrpcrawl:(.+)/);if(!e)return;if(e=JSON.parse(b(e[1])),!e||!e.id)return;this._respondWithHandshake(e),this._respondWithContent(e)}catch{}},_respondWithHandshake(e){const t={type:"crawl.handshake",id:e.id};n.parent.postMessage(t,"*")},_respondWithContent(e){const r={markdown:"",ts:Date.now()},i=t=>{const r={type:"crawl.result",id:e.id,result:t};n.parent.postMessage(r,"*")},s=()=>{const t=Math.min(100,e.forceAt-Date.now());setSafeTimeout(o,t)},o=()=>{let n=t.parser.markdown();const o=Date.now();o>=e.forceAt?i(n):"loading"===w.readyState?s():r.markdown!==n?(r.markdown=n,r.ts=o,s()):o-r.ts>=500?i(n):s()};o()},async crawl(e,t){const{timeout:r,startedAt:i}=t,s=Date.now()+r-500,o=Math.random().toString(36).slice(2),a=w.createElement("iframe");a.name=`__hrpcrawl:${_(JSON.stringify({id:o,forceAt:s}))}`,a.src=e,a.sandbox="allow-scripts allow-same-origin",a.style.position="fixed",a.style.top=0,a.style.right=0,a.style.width="100%",a.style.height="100%",a.style.border="none",a.style.zIndex="-1",a.style.visibility="hidden",a.style.opacity="0",a.style.pointerEvents="none",w.body.appendChild(a);if(!await new Promise((e=>{const t=setSafeTimeout((()=>{n.removeEventListener("message",s),e(null)}),Math.min(3e3,r+i-Date.now())),s=({data:r})=>{r?.id===o&&"crawl.handshake"===r?.type&&(v(t),n.removeEventListener("message",s),e(r))};n.addEventListener("message",s)})))return a.remove(),null;const l=await new Promise((e=>{const t=setSafeTimeout((()=>{n.removeEventListener("message",i),e(null)}),r),i=({data:r})=>{r?.id===o&&"crawl.result"===r?.type&&(v(t),n.removeEventListener("message",i),e(r.result))};n.addEventListener("message",i)}));return a.remove(),l}}})(),(()=>{const{$engine:t}=e;t.fetcher={async fetch(e,t){let r=(t={credentials:"include",...t}).representation||"auto";const n=await E(e,t),i={headers:Object.fromEntries(n.headers.entries()),ok:n.ok,redirected:n.redirected,status:n.status,type:n.type,url:n.url};if(!n.ok)return i;if("auto"===r){const e=n.headers.get("content-type")||"";r=e.startsWith("text/")?"text":e.startsWith("multipart/form-data")?"formData":e.startsWith("application/json")?"json":"text"}if(r&&"none"!==r)try{"text"===r?i.body=await n.text():"formData"===r?i.body=await n.formData():"json"===r&&(i.body=await n.json())}catch(e){i.body=new Error(`failed converting response to ${r}`)}return i}}})(),(()=>{const{$engine:t,$utils:r}=e;t.frame={init(){this._reset()},injected(){return this._injected},inject(){this._injected||(this._injected=!0,this._root=w.querySelector("__hrp__"),this._createFrame(),this._createHeader(),this._createResizer(),this._createIframe(),this._setupDragLogic(),this._setupResizeLogic(),this._fitFrameToScreenOnResize(),this._watchEngineState(),this._update({}))},eject(){this._injected&&(this._frame.remove(),this._stopStateWatcher(),Array.from(this._timeouts).forEach((e=>v(e))),n.removeEventListener("resize",this._onWindowResize),this._reset())},send(e,...t){this._injected&&this._iframe.contentWindow.postMessage({name:e,args:t},"*")},setWidth(e){this._injected&&this._update({width:e})},_reset(){this._root=null,this._frame=null,this._header=null,this._resizer=null,this._iframe=null,this._onWindowResize=null,this._stopStateWatcher=null,this._timeouts=new Set,this._injected=!1,this._state={theme:"day",width:430,open:!1,dragging:!1,dx:0,dy:0}},_createFrame(){this._frame=w.createElement("div"),this._frame.classList.add("HrpFrame"),this._root.append(this._frame)},_createHeader(){this._header=w.createElement("div"),this._header.classList.add("HrpFrame__header"),this._frame.append(this._header)},_createResizer(){this._resizer=w.createElement("div"),this._resizer.classList.add("HrpFrame__resizer"),this._frame.append(this._resizer)},_createIframe(){const e=this._root.dataset.extId;this._iframe=w.createElement("iframe"),this._iframe.src=`chrome-extension://${e}/harpa.html?popup`,this._iframe.allow="clipboard-write",this._iframe.classList.add("HrpFrame__iframe");const t=w.createElement("div");t.classList.add("HrpFrame__content"),t.append(this._iframe),this._frame.append(t)},_watchEngineState(){let e=!1;this._stopStateWatcher=t.state.observe((t=>{const r={};r.theme=t.theme,r.editing=t.editing,r.open=t.frameOpen,e||(e=!0,r.width=t.frameWidth),this._update(r),this._setTimeout((()=>this._fitFrameToScreen()),50)}))},_setupDragLogic(){let e=0,t=0;const n=e=>{this._update({dragging:!1}),this._fitFrameToScreen(),r.style.reset(w.body),w.removeEventListener("mouseup",n),w.removeEventListener("mousemove",i)},i=r=>{this._update({dx:r.clientX-e,dy:r.clientY-t})};this._header.addEventListener("mousedown",(s=>{s.preventDefault(),s.stopPropagation(),this._update({dragging:!0}),e=s.clientX-this._state.dx,t=s.clientY-this._state.dy,r.style.override(w.body,"pointer-events","none"),w.addEventListener("mouseup",n),w.addEventListener("mousemove",i)}),!0)},_setupResizeLogic(){let e=0,n=0;const i=()=>{this._update({dragging:!1}),r.style.reset(w.body),w.removeEventListener("mouseup",i),w.removeEventListener("mousemove",s)},s=r=>{const i=r.clientX-e;this._update({width:n-i}),t.state.transaction((e=>e.frameWidth=this._frame.offsetWidth))};this._resizer.addEventListener("mousedown",(t=>{t.preventDefault(),t.stopPropagation(),this._update({dragging:!0}),e=t.clientX,n=this._frame.offsetWidth,r.style.override(w.body,"pointer-events","none"),w.addEventListener("mouseup",i),w.addEventListener("mousemove",s)}),!0)},_fitFrameToScreenOnResize(){let e;this._onWindowResize=()=>{v(e),e=this._setTimeout((()=>this._fitFrameToScreen()),300)},n.addEventListener("resize",this._onWindowResize)},_winWidth:()=>Math.min(w.documentElement.clientWidth,n.innerWidth),_update(e={}){const t=Object.assign(this._state,e),r=this._frame;if(!r)return;"fullscreen"===t.width&&(t.width=n.innerWidth),r.style.translate=`${t.dx}px ${t.dy}px`,r.style.width=`${t.width}px`;const i=r.offsetWidth;w.documentElement.classList.toggle("HrpFrame--open",t.open),r.classList.toggle("HrpFrame_open",t.open),r.classList.toggle("HrpFrame_editing",t.editing),r.classList.toggle("HrpFrame_night","night"===t.theme),r.classList.toggle("HrpFrame_dragging",t.dragging),r.classList.toggle("HrpFrame_wide",i>=n.innerWidth-100),!0===e.open?r.focus():!1===e.open&&(w.body.setAttribute("tabindex",0),w.body.focus({preventScroll:!0}))},_fitFrameToScreen(){let e=this._state.dx;const t=this._winWidth(),r=this._frame.offsetWidth,n=t-24-r+e;n<24?e+=24-n:n+r>t-24&&(e-=n+r-t+24),this._update({dx:Math.round(e),dy:0})},_setTimeout(e,t){const r=N((()=>{this._timeouts.delete(r),e()}),t);this._timeouts.add(r)}}})(),(()=>{const{$engine:t}=e;t.functions={getTranscriptDetails:async()=>new Promise((e=>{const t=self.XMLHttpRequest.prototype.open;self.XMLHttpRequest.prototype.open=function(r,n){if(t.apply(this,arguments),!n.includes("/timedtext?"))return;self.XMLHttpRequest.prototype.open=t;const i=new URLSearchParams(n.split("?")[1]),s=Object.fromEntries(i.entries());e({params:s})};const r=()=>w.querySelector(".ytp-subtitles-button").click();r(),N(r)}))}})(),(()=>{const{$engine:t,$utils:r}=e;t.idleWatcher={DEBUG_LOG:!1,IDLE_DURATION:1500,MAX_REQUESTS_PER_URL:1,MAX_MUTATIONS_PER_TARGET:1,VISIBLE_ATTRIBUTES:new Set(["class","style","alt","cols","colspan","dir","disabled","height","hidden","label","name","poster","readonly","required","reversed","rows","rowspan","shape","size","span","src","srcdoc","srcset","start","step","title","translate","type","value","width"]),init(){this._navigationPromise=new Promise((e=>{if("complete"===w.readyState)return void e();const t=r=>{"complete"===r.target.readyState&&(w.removeEventListener("readystatechange",t),e())};w.addEventListener("readystatechange",t)})),this._lastNetIdle=Date.now(),this._requestCount=0,this._requestsPerUrl={},this._scripts=new Set,this._loadedScriptPaths=new Set,this._lastDomIdle=Date.now(),this._mutations={attributes:Symbol("mAttributes"),characterData:Symbol("mCharacterData"),childList:Symbol("mChildList")},this._eraseMutationsBefore=-1,this._observeXhr(),this._observeFetch(),this._observeScripts(),this._navigationPromise.then((()=>{this._observeMutations()}))},async waitForDocumentReady(){return this._navigationPromise},async waitForIdle(e){if(!e||e<1)return;let t=!1;const r=new Promise((r=>setSafeTimeout((()=>{t=!0,r()}),e)));await Promise.race([r,this._navigationPromise.then((()=>new Promise((e=>{this._requestsPerUrl={},this._eraseMutationsBefore=Date.now()-this.IDLE_DURATION;const r=()=>{if(t)return void e();const r=-1!==this._lastNetIdle?this._lastNetIdle+this.IDLE_DURATION-Date.now():this.IDLE_DURATION/5,n=-1!==this._lastDomIdle?this._lastDomIdle+this.IDLE_DURATION-Date.now():this.IDLE_DURATION/5,s=Math.max(r,n);s<=0?e():setSafeTimeout(i,s)},i=()=>{const e={timeout:this.IDLE_DURATION/5};n.requestIdleCallback(r,e)};i()}))))]),i("page is idle"),t=!0},get requestCount(){return this._requestCount},set requestCount(e){this._requestCount!==e&&(this._requestCount=e,this._lastNetIdle=0===e?Date.now():-1)},_onRequestSent(e){if(!e)return!1;let t=e instanceof u?e.url:e;if(!t)return!1;if(t=t.href?t.href:t,!t?.split)return!1;if(t=t.split("?")[0],!t)return!1;return(this._requestsPerUrl[t]||0)<this.MAX_REQUESTS_PER_URL&&(this.requestCount++,this._requestsPerUrl[t]=(this._requestsPerUrl[t]||0)+1,i("+ request"),!0)},_onResponseReceived(e){let r=e instanceof u?e.url:e;r&&(r=r.href?r.href:r,r=r.split("?")[0],this._requestsPerUrl[r]=(this._requestsPerUrl[r]||1)-1,t.idleWatcher.requestCount--,i("- request"))},_observeXhr(){function e(){this._track&&(this.readyState!==f.DONE&&this.readyState!==f.UNSENT||(this.removeEventListener("readystatechange",e),t.idleWatcher._onResponseReceived(this._url)))}const r=f.prototype.open;f.prototype.open=function(){return this._url=arguments[1],this.addEventListener("readystatechange",e),r.apply(this,arguments)};const n=f.prototype.send;f.prototype.send=function(){return this._track=t.idleWatcher._onRequestSent(this._url),n.apply(this,arguments)}},_observeFetch(){const e=globalThis.fetch;globalThis.fetch=function(...r){return t.idleWatcher._onRequestSent(r[0])?new Promise(((n,i)=>{e(...r).then(((...e)=>{t.idleWatcher._onResponseReceived(r[0]),n(...e)})).catch(((...e)=>{t.idleWatcher._onResponseReceived(r[0]),i(...e)}))})):e(...r)}},_observeScripts(){const e=new Set([null,"module","text/javascript","application/javascript"]),t=e=>{e.target.removeEventListener("load",t),e.target.removeEventListener("error",t);const r=this._scripts.size,n=(e.target.src||"").split("?")[0];this._loadedScriptPaths.add(n),this._scripts=new Set(Array.from(this._scripts).filter((e=>!e.src.startsWith(n))));const s=r-this._scripts.size;this.requestCount-=s,i("- script request")};return r.mutation.on(w.documentElement,{childList:!0,subtree:!0},(n=>{r.mutation.addedElements(n).filter((t=>"SCRIPT"===t.tagName&&t.src&&!t.noModule&&!t.textContent&&e.has(t.getAttribute("type"))&&!this._loadedScriptPaths.has(t.src.split("?")[0])&&!this._scripts.has(t))).forEach((e=>{i("+ script request"),this._scripts.add(e),this.requestCount+=1,e.addEventListener("load",t),e.addEventListener("error",t)})),r.mutation.removedElements(n).filter((e=>this._scripts.has(e))).forEach((e=>t({target:e})))}))},_observeMutations(){return r.mutation.on(w.documentElement,{childList:!0,subtree:!0,attributeFilter:Array.from(this.VISIBLE_ATTRIBUTES)},(e=>{let t=!1;const r=Date.now();e.forEach((e=>{const n=this._mutations[e.type];if(!n)return;if("attributes"===e.type&&!this.VISIBLE_ATTRIBUTES.has(e.attributeName))return;const s=e.target;s[n]||(s[n]={count:0,last:r});const o=s[n];o.last<=this._eraseMutationsBefore?(i(`+ mutation ${e.type}`),t=!0,o.count=1,o.last=r):o.count<this.MAX_MUTATIONS_PER_TARGET&&(i(`+ mutation ${e.type}`),t=!0,o.count++,o.last=r)})),t&&(this._lastDomIdle=Date.now())}))}};const i=e=>{if(!t.idleWatcher.DEBUG_LOG)return;const r=t.idleWatcher._requestCount;t.log(`${e}: requests ${r}`)}})(),(()=>{const{$engine:t,$utils:r}=e,o=globalThis.__elPreload?.ipcRenderer,a=!!globalThis.__elPreload;t.injection={async init(){if(S.config)this.config=S.config;else try{this.config=JSON.parse(C.getItem("__hrp.config")),C.removeItem("__hrp.config")}catch{}this.config&&this.config.frameName&&(this._addTrustedTypePolicy(),t.state.init(),t.timer.init(),t.idleWatcher.init(),t.memoizer.init(),t.query.init(),t.inspector.init(),t.pdf.init(),t.parser.init(),t.muter.init(this.config),t.simulator.init(),t.screenshotter.init(),t.frame.init(),t.trapper.init(),t.crawler.init(),this._registerCommandListeners(),this._handleIframes(),this.config.waitForDocumentBody&&await this._waitForDocumentBody(),this.config.waitForDocumentReady&&await t.idleWatcher.waitForDocumentReady(),this._sendConnected())},_handleIframes(){if("docs.google.com"===w.domain)return;let e=this.config.configString;const t=t=>{if(t.closest("__hrp__"))return;const r=(e=>{try{return new p(e.src)}catch{return null}})(t);r&&r.origin!==x.origin?(r.hash?r.searchParams.set("__hrp",e):r.hash=`__hrp=${e}`,t.src=r.href):t.setAttribute("__hrp",e)};w.querySelectorAll("iframe").forEach((e=>t(e))),r.mutation.on(w.documentElement,["childList","subtree"],(e=>{r.mutation.addedElements(e).filter((e=>"IFRAME"===e.tagName)).forEach((e=>t(e)))}))},sendEvent(e,r){this.config?.frameName&&this._sendMessage({type:e,frameName:this.config.frameName,...r&&t.serializer.serialize(r)})},_sendResponse(e,r){this.config?.frameName&&this._sendMessage({type:"response",frameName:this.config.frameName,request:e,result:t.serializer.serialize(r.result),error:t.serializer.serialize(r.error)})},async _waitForDocumentBody(){if(w.body)return;const e=w.documentElement;return new Promise((t=>{const n=r.mutation.on(e,"childList",(()=>{w.body&&(n.disconnect(),t())}))}))},_sendConnected(){this.config?.frameName&&this._sendMessage({type:"connected",frameName:this.config.frameName})},_addTrustedTypePolicy(){if(n.trustedTypes?.createPolicy&&!n.trustedTypes.defaultPolicy)try{trustedTypes.createPolicy("default",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch(e){s.warn(e)}},_registerCommandListeners(){this._onMessage((async e=>{const r=this._getRequestFromMessage(e);if(!r)return;const n=this._getMethodToCall(r);if(!n)return;const i=this._getMethodOptions(r);if(!i)return;const s=()=>{if(i.timeout&&!(Date.now()-i.startedAt<i.timeout))throw"skip-response"};try{if(i.hasOwnProperty("frame")&&null!==i.frame)return void this._proxyMessageToIframe(e,i.frame);const o=t.serializer.deserialize(r.params)||[],a=await n(...o,i);if(s(),i.idle){const e="number"==typeof i.idle?i.idle:15e3;e>0&&await t.page.idle({timeout:e}),s()}t.injection._sendResponse(r,{result:a})}catch(e){if("skip-response"===e)return;t.injection._sendResponse(r,{error:e})}}))},_proxyMessageToIframe(e,t){Array.isArray(t)||(t=[t]);const r=t.shift();0===t.length&&delete e.data.options.frame;const n=this._resolveFrame(r);if(!n)throw new Error(`frame not found: ${JSON.stringify(r)}`);n.contentWindow.postMessage(e.data,"*")},_resolveFrame(e){if(null==e)return null;if("number"==typeof e){return w.querySelectorAll("iframe")[e]}if("string"==typeof e){const t=w.querySelectorAll("iframe");return Array.from(t).find((t=>t.name===e))}return(e=t.query.run(e))&&"IFRAME"===e.tagName?e:null},_getRequestFromMessage(e){const t=e.data;return t.frameName!==this.config.frameName?null:t},_getMethodToCall(e){let r=e.command;if(!r)return null;let n=t.page;for(;r.includes(".");){const[e,...t]=r.split(".");n=n[e],r=t.join(".")}const i=n[r];return i?i.bind(n):(t.injection._sendResponse(e,{error:"command-not-supported"}),null)},_getMethodOptions:e=>({startedAt:Date.now(),...e.options}),_sendMessage(e){i.postMessage(e,"*"),a&&o.send("engine.mediumMessage",e)},_onMessage(e){n.__hrpc&&n.removeEventListener("message",n.__hrpc),n.__hrpc=e,n.addEventListener("message",e),a&&o.on("engine.mediumMessage",((t,r)=>e({data:r})))}}})(),(()=>{const{$engine:t,$utils:r}=e,i=w.TEXT_NODE;t.inspector={CACHED_METHODS:["isConnected","isVisible","isHiddenByStyles","isClickable","isFixed","innerText","style","styleHashDefault","fontSize","lineHeight","rect","contentRect","rectAdjustedToViewport","clientRects","boundingClientRect","blockLineHeight","role","path","anchorPoint","toElement"],init(){this._range=w.createRange(),t.memoizer.memoizeAll(this,this.CACHED_METHODS)},isConnected:e=>!!e&&(e instanceof c&&e.isConnected),isVisible(e){if(!e)return!1;if(!this.isConnected(e))return!1;const t=this.toElement(e);if(!t)return!1;{const e=this.style(t).visibility;if("hidden"===e)return!1;if("collapse"===e)return!1}if(this.isHiddenByStyles(t))return!1;{const e=this.contentRect(t);if(e.width<=1)return!1;if(e.height<=1)return!1;if(e.right<=0)return!1;if(!e.sx&&e.left>=w.documentElement.scrollWidth)return!1}return!0},isHiddenByStyles(e){const t=this.style(e);if("none"===t.display)return!0;if("hidden"===t.contentVisibility)return!0;if(Number(t.opacity)<.1)return!0;const r=t.clip;return"rect(0px, 0px, 0px, 0px)"===r||"rect(1px, 1px, 1px, 1px)"===r||!(!(e=e.parentElement)||e===w.body)&&this.isHiddenByStyles(e)},isInViewport(e,t="center"){if(!e)return!1;const r=this.toElement(e);if(!r)return!1;if(!this.isConnected(e))return!1;const n=this.rectAdjustedToViewport(r),{clientWidth:i,clientHeight:s}=w.documentElement;if("center"===t)return n.cx>=0&&n.cy>=0&&n.cx<=i&&n.cy<=s;if("full"===t)return n.left>=0&&n.top>=0&&n.right<=i&&n.bottom<=s;if("part"===t)return!(n.top>=s)&&(!(n.bottom<=0)&&(!(n.left>=i)&&!(n.right<=0)));throw new Error(`unsupported isInViewport algorithm ${t}`)},isClickable(e){if(!e)return!1;const t=this.toElement(e);if(!t)return!1;if(!this.isInViewport(t))return!1;if(!this.isVisible(t))return!1;const r=this.rectAdjustedToViewport(t);let n=w.elementFromPoint(r.cx,r.cy);for(;n;){if(n===t)return!0;n=n.parentNode}return!1},isFixed(e){if(!e)return!1;let t=this.toElement(e);for(;t&&t!==w.body;){const e=this.style(t).position;if("fixed"===e||"sticky"===e)return!0;t=t.parentElement}return!1},innerText:e=>e.innerText||"",style(e){return e.nodeType===i?this.style(e.parentElement):n.getComputedStyle(e)},styleHash(e,t){const r=this.style(e);if(t){if(0===(t=t.split(":")).length)return""}else t=["fontFamilyPrimary","fontSize","fontWeight","fontStyle"];let n=[];return t.forEach((e=>{if("fontFamilyPrimary"===e){const e=r.fontFamily||"",t=e.indexOf(", ");n.push(t>0?e.slice(0,t):e)}else n.push(r[e])})),n.join(":")},styleHashDefault(e){return this.styleHash(e)},rect(e){let r;if(e.nodeType===i){try{this._range.selectNode(e)}catch{}r=this._range.getBoundingClientRect(),this._range.setStart(e,0),this._range.setEnd(e,0);const t=this._range.getBoundingClientRect();t.top>=r.top&&(r.lineShift=t.left-r.left)}else if(r=e.getBoundingClientRect(),0===r.height&&0===this.lineHeight(e)){try{this._range.selectNode(e)}catch{}r=this._range.getBoundingClientRect()}let{top:s,left:o,width:a,height:l}=r;const{scrollX:c,scrollY:h}=n;0===c&&0===h||this.isFixed(e)||(o+=c,s+=h);const m=new t.Rect(s,o+a,s+l,o);if(void 0!==r.lineShift&&(m.lineShift=r.lineShift),e.nodeType===i){const t=this.blockLineHeight(e);if(t>=m.height){const e=t-m.height;m.top-=e/2,m.bottom+=e/2}}return m},contentRect(e){const t=this.rect(e);if(0===t.width||0===t.height)return t;if(e.nodeType!==i){const r=this.style(e),{paddingTop:n,paddingRight:i,paddingBottom:s,paddingLeft:o}=r,a={top:Number(n.slice(0,-2)),right:Number(i.slice(0,-2)),bottom:Number(s.slice(0,-2)),left:Number(o.slice(0,-2))};t.top+=a.top,t.right-=a.right,t.bottom-=a.bottom,t.left+=a.left}let r=this.toElement(e);for(;r&&r!==w.body;){const e=this.style(r);if(!t.sx){const n=e.overflowX;if("auto"===n||"scroll"===n){if(t.sy)break;t.sx=!0}else if("hidden"===n){const e=this.rect(r);t.left=Math.max(t.left,e.left),t.right=Math.min(t.right,e.right)}}if(!t.sy){const n=e.overflowY;if("auto"===n||"scroll"===n){if(t.sx)break;t.sy=!0}else if("hidden"===n){const e=this.rect(r);t.top=Math.max(t.top,e.top),t.bottom=Math.min(t.bottom,e.bottom)}}r=r.parentElement}return t},clientRects:e=>e.getClientRects(),boundingClientRect:e=>e.getBoundingClientRect(),blockLineHeight(e){const t=this.toElement(e),r=this.fontSize(t);let n=this.lineHeight(t);if(n>1.75*r&&(n=r),0!==t.offsetWidth){const e=this.clientRects(t);if(0===e.length)return n;let{left:r,right:i}=e[0];for(let t=1;t<e.length;t++)e[t].left<r&&(r=e[t].left),e[t].right>i&&(i=e[t].right);const s=Math.round(i-r)/t.offsetWidth;(s<.9||s>1.1)&&(n*=s)}return n},fontSize(e){const t=this.toElement(e),r=this.style(t)["font-size"];return Number(r.slice(0,-2))},lineHeight(e){const t=this.toElement(e),r=this.style(t).lineHeight;return"normal"===r?1.2*this.fontSize(t):Number(r.slice(0,-2))},rectAdjustedToViewport(e){const r=this.rect(e),{scrollX:i,scrollY:s}=n;if(0===i&&0===s)return r;if(this.isFixed(e))return r;const o=new t.Rect(r.top-s,r.right-i,r.bottom-s,r.left-i);return void 0!==r.lineShift&&(o.lineShift=r.lineShift),o},role(e){const r=this.toElement(e);if(r.hasAttribute("role"))return r.getAttribute("role");const n=t.tagsToRoles[r.nodeName];return n?"function"==typeof n?n(r):n:null},path(e){if(!e||!e.isConnected)return null;if(e===w.documentElement)return[];const t=e.parentElement,r=Array.prototype.indexOf.call(t.children,e);return[...this.path(t),r]},commonParentNode(e){if(!e||0===e.length)return null;if(1===e.length)return e[0];let t=e[0].parentNode,r=e.slice(1);if(r.every((e=>e===t||e.parentNode===t)))return t;for(;t;){if(r=r.filter((e=>!t.contains(e))),0===r.length)return t;t=t.parentNode}return t},toElement(e){for(;e&&!(e instanceof Element);)e=e.parentElement;return e},anchorPoint(e){const t=this.style(e)["text-align"],r=this.rect(e),n=Math.round(r.top+Math.min(5,r.height/2));return{x:Math.round("right"===t?r.right-Math.min(5,r.width/2):"center"===t?r.cx:r.left+Math.min(5,r.width/2)),y:n}},distance(e,t,r="number"){e=e instanceof c?this.anchorPoint(e):e;const n=(t=t instanceof c?this.anchorPoint(t):t).x-e.x,i=t.y-e.y,s=Math.sqrt(Math.pow(n,2)+Math.pow(i,2));return"number"===r?s:{d:s,dx:n,dy:i}},inspect(e,n={}){if(n={inspect:!0,computeAiLocator:!1,parsedPage:null,...n},!e)return[];let i=Array.isArray(e);if(i||(e=[e]),0===e.length)return[];const s=new Map;let o=n.computeAiLocator&&t.locatorAi.computeAnchors(n.parsedPage);const a=e.map((e=>{const i=s.get(e);if(i)return r.cloneDeep(i);let a,l;return n.inspect&&(a=t.locatorAi.computeInspectionData(e)),n.computeAiLocator&&(l=t.locatorAi.computeAiLocator(e,a,o),a={...a,locator:l}),s.set(e,a),a}));return i?a:a[0]}}})(),(()=>{const{$engine:t,$utils:r}=e;t.locatorAi={computeAiLocator(e,r,n){r=r||this.computeInspectionData(e),n=n||this.computeAnchors();const i=new Set(["id","class","placeholder","data-testid","title","alt","src"]);let s=[this._canUseSelector(r.tag)&&{$tag:r.tag},this._canUseSelector(r.role)&&{$role:r.role},this._canUseSelector(r.id)&&{$id:r.id},...r.classes.filter((e=>this._canUseSelector(e))).map((e=>({$class:e}))),...Object.keys(r.attributes).filter((e=>!i.has(e))).filter((e=>{const t=r.attributes[e]||"";return t.length<=256&&!t.includes('"')})).map((e=>{const t=r.attributes[e];return{$attribute:t?`${e}=${t}`:`${e}`}})),this._canUseSelector(r.testId)&&{$testId:r.testId},this._canUseSelector(r.title)&&{$title:r.title},this._canUseSelector(r.altText)&&{$altText:r.altText},this._canUseSelector(r.src)&&{$src:r.src},this._canUseSelector(r.style)&&{$style:r.style},this._canUseSelector(r.template)&&{$content:r.template},this._canUseSelector(r.placeholder)&&{$placeholder:r.placeholder},...this._createTraverseSelectors(e,5),...this._createAnchorSelectors(e,n)].filter((e=>Boolean(e)));const o=new Map;let a=0;return s.map((e=>t.query.run(e,{m:!0}))).flat().forEach((t=>{const r=(o.get(t)||0)+1;o.set(t,r),t!==e&&(a=a<r?r:a)})),a===s.length&&s.push({$tag:w.documentElement.tagName,traverse:this._traversePath(w.documentElement,e)}),s=[{$matches:s,min:a+1},{$size:1}],{__$ht:"locator",selector:s}},computeInspectionData(e){if(!(e&&e instanceof c))return null;const n=e.tagName,i=Array.from(e.classList),s={};e.getAttributeNames().forEach((t=>{s[t]=e.getAttribute(t)}));const o=(t.inspector.innerText(e)||"").trim(),a=r.extractor.extract(o).template,l={isConnected:t.inspector.isConnected(e),isVisible:t.inspector.isVisible(e),isInViewport:t.inspector.isInViewport(e),isClickable:t.inspector.isClickable(e),isFixed:t.inspector.isFixed(e),rect:t.inspector.rect(e),cr:t.inspector.contentRect(e),tag:n,classes:i,attributes:s,id:s.id,testId:s["data-testid"],placeholder:s.placeholder,title:s.title,altText:s.alt,src:s.src,role:t.inspector.role(e),fontSize:t.inspector.fontSize(e),style:t.inspector.styleHashDefault(e),text:o,template:a};return Object.keys(l).filter((e=>["",null,void 0].includes(l[e]))).forEach((e=>delete l[e])),l},computeAnchors(e=null){e=e||t.parser.parse(null,{inspect:!1,extract:!0});const r=new Set,n={};return e.filter((e=>"text"===e.type&&e.container)).filter((e=>!r.has(e.container)&&(r.add(e.container),!0))).map((e=>({container:e.container,text:e.template||e.value}))).filter((e=>e.text)).map((e=>(n[e.text]=(n[e.text]||0)+1,e))).filter((e=>!e.text.includes("{{data}}"))).filter((e=>n[e.text]<5))},findClosestAnchors(e,r){if(!r)return[];if(0===(r=r.filter((t=>t.container!==e&&!e.contains(t.container)&&!t.container.contains(e)))).length)return[];r=r.map((r=>({text:r.text,container:r.container,...t.inspector.distance(r.container,e,"object")})));const n=[];return r.forEach((e=>{!n[0]||e.d<n[0].d?(n[2]=n[1],n[1]=n[0],n[0]=e):!n[1]||e.d<n[1].d?(n[2]=n[1],n[1]=e):(!n[2]||e.d<n[2].d)&&(n[2]=e)})),n.filter((e=>Boolean(e)))},_createAnchorSelectors(e,t){return(t=this.findClosestAnchors(e,t)).map((t=>[{$anchor:t.text,shift:[t.dx,t.dy].join(":")},{$text:t.text,traverse:this._traversePath(t.container,e)}])).flat()},_createTraverseSelectors(e,r=null){const n=[],i=e.parentNode,s=e.childNodes,o=[];let a=i?.parentNode;for(;a;)o.push(a),a=a.parentNode;const l=[i,...s,...o].filter((e=>e!==w.body&&w.body.contains(e))).filter((e=>e.nodeType!==w.TEXT_NODE)).filter((e=>e.nodeType!==w.COMMENT_NODE));for(const i of l){let s=[];i.id&&s.push({$id:i.id});const o=t.inspector.role(i);o&&s.push({$role:o});const a=Array.from(i.classList).filter((e=>this._canUseSelector(e))).map((e=>({$class:e})));if(s.push(...a),0===s.length)continue;const l={traverse:this._traversePath(i,e)};if(s=s.filter((e=>1===t.query.run(e,{m:!0}).length)).forEach((e=>{n.push({...e,...l})})),r&&n.length>=r)return n.slice(0,r)}return n},_traversePath(e,r){if(e===r)return[];const n=t.inspector.path(e),i=t.inspector.path(r);let s=0;for(;n[s]===i[s];)s++;const o=n.length-s;return(o>0?[-o]:[]).concat(i.slice(s)).join(":")},_canUseSelector:e=>e&&String(e).length<=256}})(),(()=>{const{$engine:t}=e;t.memoizer={init(){this._isObserving=!1,this._caches=[],this._caches.hasUpdates=!1,this._onMutation=this._onMutation.bind(this),this._mutationObserver=new l(this._onMutation)},memoizeAll(e,t){t.forEach((t=>{const r=e[t].bind(e);e[t]=this.memoize(r)}))},memoize(e){const t=new Map;return this._caches.push(t),r=>{const n=arguments.length;if(1!==n)throw new Error(`function is memoized and expects single argument, passed ${n}`);this._isObserving||(this._isObserving=!0,this._observeChanges());let i=t.get(r);return void 0!==i||(i=e(r),t.set(r,i),this._caches.hasUpdates=!0),i}},_observeChanges(){w.addEventListener("scroll",this._onMutation),this._mutationObserver.observe(w.documentElement,{attributes:!0,childList:!0,characterData:!0,subtree:!0})},_onMutation(){this._caches.hasUpdates&&this.cleanupCache(),this._caches.hasUpdates=!1,w.removeEventListener("scroll",this._onMutation),this._mutationObserver.disconnect(),this._isObserving=!1},cleanupCache(){this._caches.forEach((e=>e.clear()))}}})(),(()=>{const{$engine:t,$utils:r}=e;t.muter={init(e){(e={muter:!0,...e}).muter&&(w.querySelectorAll("audio, video").forEach((e=>this._muteMediaElements(e))),r.mutation.on(w.documentElement,["childList","subtree"],(e=>{r.mutation.addedElements(e).forEach((e=>this._muteMediaElements(e)))})))},_muteMediaElements(e){if(!["AUDIO","VIDEO"].includes(e.tagName))return;e.muted=!0,e.removeAttribute("autoplay");const t=()=>{e.pause(),e.muted=!0};e.addEventListener("canplay",t),e.addEventListener("play",t)}}})(),(()=>{const{$engine:t,$gdocs:r,$utils:i}=e;t.page={get timer(){return t.timer},get frame(){return t.frame},get trapper(){return t.trapper},get screenshotter(){return t.screenshotter},get state(){return t.state},url:()=>n.location.href,async content(e,{contentType:n=null}={}){if(!n||"auto"===n)return await this.content(e,{contentType:"pdf"})||await this.content(e,{contentType:"gdocs"})||await this.content(e,{contentType:"innerText"});let i=w.documentElement;if(e&&(i=t.query.run(e)),"htmlContent"===n){let e="";return i===w.documentElement&&w.doctype&&(e+=(new g).serializeToString(w.doctype)),i&&(e+=i.outerHTML),e}if("textContent"===n)return i?.textContent;if("innerText"===n)return i?.innerText;if("outerText"===n)return i?.outerText;if("outerHTML"===n)return i?.outerHTML;if("innerHTML"===n)return i?.innerHTML;if("pdf"===n)return t.pdf.pdfContent();if("gdocs"===n)return r.controller.getText();throw new Error(`unsupported options.contentType ${n}`)},async favicons(){const e=e=>{const t=e.sizes?.value?.match(/^(\d+)/);return t?Number(t[1]):0},t=Array.from(w.querySelectorAll('link[rel*="icon"]'));return t.sort(((t,r)=>"icon"===t.rel&&"icon"!==r.rel?-1:"icon"!==t.rel&&"icon"===r.rel?1:e(r)-e(t))),t.map((e=>e.href)).filter(Boolean)},async idle(e){const{timeout:r}=e;if(!r||r<1)return{durationMs:0};const n=Date.now();return await t.idleWatcher.waitForIdle(r),{durationMs:Date.now()-n}},fetch:async(e,r)=>t.fetcher.fetch(e,r),query:async(e,r)=>t.query.run(e,r),crawl:async(e,r,n)=>t.crawler.crawl(e,r,n),async parse(e,r){const n=e&&this._toNode(e,r)||w.body;return t.parser.parse(n,r)},async markdown(e,r){const n=e&&this._toNode(e,r)||w.body;return t.parser.markdown(n,r)},async inspect(e,r){const n=e&&this._toNode(e,r)||w.body;return t.inspector.inspect(n,r)},async click(e,r,n){const i=this._toNode(e,n)||w.body,s=i.innerText||null;return n.noScroll||await t.scroller.scroll(i),await t.simulator.click(i,r),{innerText:s}},async scroll(e,r){return"object"!=typeof e||e.hasOwnProperty("x")||e.hasOwnProperty("y")||(e=await this._toNode(e)),t.scroller.scroll(e,r)},async back(){n.history.back()},async forward(){n.history.forward()},async reload(){x.reload()},async unregisterServiceWorker(){const e=await S.serviceWorker.getRegistrations();if(0!==e.length)for(const t of e)await t.unregister()},async grab(e,t,r,i){e=e||"body";let s=[];if(["auto","css"].includes(i)&&0===s.length)try{s=Array.from(w.querySelectorAll(e))}catch{}if(["auto","xpath"].includes(i)&&0===s.length)try{const t=w.evaluate(e,w.documentElement,null,y.ORDERED_NODE_SNAPSHOT_TYPE,null);for(let e=0;e<t.snapshotLength;e++)s.push(t.snapshotItem(e))}catch{}if(["auto","text"].includes(i)&&0===s.length)try{const t=e.toLowerCase();s=Array.from(w.querySelectorAll("body *")).filter((e=>e.textContent.toLowerCase().includes(t))),s=s.filter((e=>!s.some((t=>t!==e&&e.contains(t)))))}catch{}return"first"===r?s=[s.at(0)]:"last"===r?s=[s.at(-1)]:"all"===r||(r=Number(r)||0,s=[s.at(r)]),0===s.length?null:(s=s.filter(Boolean).map((e=>{if(!e)return null;if("innerText"===t)return e.innerText;if("textContent"===t)return e.textContent;if("id"===t)return e.id||null;if("class"===t||"className"===t)return e.className;if("nodeName"===t)return e.nodeName;if("nodeType"===t)return e.nodeType;if("attributes"===t)return Array.from(e.attributes).map((e=>`${e.name}="${e.value}"`)).join(";");if("style"===t||"styles"===t){const t=n.getComputedStyle(e);return Object.keys(t).filter((e=>!!t.getPropertyValue(e))).map((e=>`${e}:${t.getPropertyValue(e)}`)).join(";")}if("innerHTML"===t)return e.innerHTML;if("outerHTML"===t)return e.outerHTML;if("value"===t)return e.value;if("href"===t)return e.href;if(t.startsWith("[")&&t.endsWith("]")){const r=t.slice(1,-1);return e.getAttribute(r)}if(t.startsWith("(")&&t.endsWith(")")){const r=t.slice(1,-1);return n.getComputedStyle(e).getPropertyValue(r)}return null})),"all"!==r&&(s=s[0]),s||null)},async evaluate(e,r){r=r||[];const s=t.functions[e];if(s)return s(...r);this._constructApi("$harpa");const o=i.createPromise(),a=`__hrp_${Math.random().toString(36).slice(2)}`;n[a]=o;const l=["(async () => {","  try {",`    const args = ${JSON.stringify(r)}`,`    const fn = ${e}`,"    const result = await fn.call(window, ...args)",`    window.${a}.resolve(result)`,"  } catch (err) {",`    window.${a}.reject(err)`,"  }",`  delete window.${a}`,"})()"].join("\n");return t.injection.sendEvent("execute",{js:l}),o},async paste(e,n,i){if(!e&&r.controller.isDocsPage())return r.controller.pasteText(n),{innerText:""};let s=this._toNode(e,i);if(!s)if("type"===i?.mode)s=this._inputElement||w.body;else if(s=this._inputElement,!s)throw new Error("element not found");return t.simulator.paste(s,n,i.mode||"insert",i.lastKey)},wait:async(e,r)=>t.waiter.wait(e,r),title:()=>w.title,description:()=>w.querySelector('meta[name="description"]')?.content||"",selection:()=>r.controller.getSelectedText()||n.getSelection()?.toString()||null,input(e,t){const r=this._toNode(e,t)||this._inputElement;if(!r)throw new Error("element not found");return r?.value||r?.innerText||r?.textContent||""},_constructApi(e){if(n.hasOwnProperty(e))return;const r={crawler:t.crawler,fetcher:t.fetcher,idleWatcher:t.idleWatcher,inspector:t.inspector,page:t.page,parser:t.parser,pdf:t.pdf,query:t.query,Rect:t.Rect,rectUtils:t.rectUtils,scroller:t.scroller,simulator:t.simulator,waiter:t.waiter,utils:i};try{const t={value:r,configurable:!1,writable:!1};Object.defineProperty(n,e,t)}catch{}},get _inputElement(){const e=e=>{const t=T(e),r=parseInt(t.paddingTop),n=parseInt(t.paddingLeft),i=parseInt(t.paddingRight),s=parseInt(t.paddingBottom);return(e.offsetWidth-n-i)*(e.offsetHeight-r-s)},t=["[contenteditable]","input:not([type]):not(:disabled)",'input[type="text"]:not(:disabled)','input[type="email"]:not(:disabled)','input[type="search"]:not(:disabled)',"textarea:not([disabled])"].join(", ");return[...w.querySelectorAll(t)].reduce(((t,r)=>t?.hasAttribute("data-last-active-input")?t:r?.hasAttribute("data-last-active-input")||e(r)>(t?e(t):-1)?r:t),null)},_toNode(e,r){if(!e)return e;if(e instanceof c)return e;if("object"==typeof e){let n=t.query.run(e,r);if(!n)throw new Error("element not found");if(Array.isArray(n)){if(0===n.length)throw new Error("element not found");if(n.length>1)throw new Error(`${n.length} matching elements found`);if(n=n[0],!n)throw new Error("element not found")}return n}throw new Error("unsupported locator type "+typeof e)}},n.page=t.page})(),(()=>{const{$engine:t,$utils:r}=e,n=w.ELEMENT_NODE,i=w.TEXT_NODE,s=w.DOCUMENT_NODE;t.parser={init(){t.memoizer.memoizeAll(this,["_orderedTree"])},markdown(e){let t=this.parse(e);t=t.filter((e=>"link"===e.type||"text"===e.type));const r=[];for(let e=1;e<t.length;e++)"link"===t[e-1].type&&t[e-1].content===t[e].value||r.push(t[e]);return r.map((e=>e.md||e.value)).join("\n")},parse(e,t){if(e=e||w.body,t={extract:!1,inspect:!1,computeAiLocator:!1,...t},!(e=this._toDocumentBodyChild(e)))return[];let r=this._orderedTree();if(!r)return null;r=this._cloneTree(r),this._dropEmptyNodes(r),this._trimAllTextNodes(r),this._extractNumericNodes(r,t),this._pruneTree(r),this._addNodePath(r),this._flattenTree(r),this._cleanupTree(r),this._addContainer(r);const n=r.children;return this._reduceTree(r,e),this._addAtSiblingIndex(r),this._addMarkdown(r),this._inspectNodes(r,n,t),r.children},_orderedTree(){let e=this._toTree(w.body);if(!e)return null;const t=this._injectViewportContainer(e);return this._reorderByContainingBlock(e,e,t),this._markViewportChildren(t),this._sortTree(e),this._mergeTreeNodes(e),this._removeViewportContainer(e,t),e},_toDocumentBodyChild:e=>e===w.body||w.body.contains(e)?e:e.contains(w.body)?w.body:null,_toTree(e){if(!e)return null;if(e.nodeType!==n&&e.nodeType!==s&&e.nodeType!==i)return null;if(e.nodeType===i)return this._textToTreeNode(e);const t=this._elementToTreeNode(e);return t.children=[...t.children||[],...Array.from(e.childNodes).map((e=>this._toTree(e))).filter((e=>Boolean(e)))],t},_textToTreeNode(e){if(!t.inspector.isVisible(e))return null;const r=e.textContent;if(!r)return null;const n=t.inspector.contentRect(e);if(0===n.width||0===n.height)return null;const i=t.inspector.style(e.parentElement);let s=r;return s=this._applyWhiteSpace(s,i["white-space"]),s=this._applyTextTransform(s,i.textTransform),{elements:[e],children:[{type:"text",value:s,elements:[e],cr:n}]}},_applyWhiteSpace:(e,t)=>["pre-line"].includes(t)?e.replaceAll(/[^\S\r\n]+/g," "):["pre","pre-wrap","break-spaces"].includes(t)?e:e.replaceAll(/\s+/g," "),_applyTextTransform:(e,t)=>"capitalize"===t?e.replace(/^\w|\W\w/g,(e=>e.toLocaleUpperCase())):"uppercase"===t?e.toLocaleUpperCase():"lowercase"===t?e.toLocaleLowerCase():e,_elementToTreeNode(e){const r=t.inspector.style(e),n=t.inspector.contentRect(e),i={elements:[e],cr:n};"static"!==r.position&&(i.position=r.position);const s=t=>{t&&null!==t.value&&void 0!==t.value&&(i.children||(i.children=[]),i.children.push({...t,elements:[e],cr:n}))},o=e=>t.inspector.contentRect(e).height/t.inspector.blockLineHeight(e);if("BR"===e.tagName&&t.inspector.isVisible(e.parentNode))return s({type:"text",value:"\n"}),i;if(!t.inspector.isVisible(e))return i;if("INPUT"===e.tagName)i.isFormElement=!0,"checkbox"===e.type?s({type:"text",value:e.checked?"ON":"OFF"}):s({type:"text",value:e.value||e.placeholder||""});else if("TEXTAREA"===e.tagName)i.isFormElement=!0,s({type:"text",value:e.value||e.placeholder||""});else if("SELECT"===e.tagName){i.isFormElement=!0;const t=Array.from(e.options).filter((e=>e.selected)).map((e=>e.textContent)).join(" & ");s({type:"text",value:t})}else if("VIDEO"===e.tagName)s({type:"video",value:e.getAttribute("src")});else if("IFRAME"===e.tagName){const t=e.getAttribute("src")||"";if(t.startsWith("https://www.youtube.com/embed/")||t.startsWith("https://youtube.com/embed/")){let e=t.split("/")[4];e&&(e=`https://www.youtube.com/watch?v=${e}`,s({type:"video",value:e}))}else try{const t=e.contentDocument?.body?.innerText||"";t&&s({type:"text",value:t})}finally{}}else if("IMG"===e.tagName)o(e)<1.5&&s({type:"text",value:""}),s({type:"image",value:e.getAttribute("src")});else if("SVG"===e.tagName)o(e)<1.5&&s({type:"text",value:""}),s({type:"icon",value:"svg"});else if("I"===e.tagName&&0===e.childNodes.length&&(e.getAttribute("class")||"").startsWith("icon-"))o(e)<1.5&&s({type:"text",value:""}),s({type:"icon",value:e.getAttribute("class").slice(5)});else if("A"===e.tagName)s({type:"link",value:e.getAttribute("href"),content:t.inspector.innerText(e).trim()});else if(e.shadowRoot){const t=e.shadowRoot.childNodes;Array.from(t).map((e=>e.innerText||e.textContent)).map((e=>e.trim())).filter((e=>e)).forEach((e=>{s({type:"text",value:e.split("\n").filter((e=>e)).map((e=>`> ${e}`)).join("\n")})}))}const a=r["background-image"];if("none"!==a){Array.from(a.matchAll(/url\(["']([^)]+)["']\)/g)).map((e=>e[1])).filter((e=>e)).forEach((t=>{o(e)<1.5&&s({type:"text",value:""}),s({type:"image",value:t})}))}return i},_injectViewportContainer(e){const t={children:[],multiblock:!0};return e.children.unshift(t),t},_removeViewportContainer(e,t){e.children=e.children.filter((e=>e!==t)),e.elements[0]===w.body&&(e.children=[...t.children||[],...e.children||[]])},_reorderByContainingBlock(e,t,r){e!==r&&e.children&&0!==e.children.length&&(["relative","sticky","fixed"].includes(e.position)&&(t=e),e.children.forEach((e=>{this._reorderByContainingBlock(e,t,r)})),e.children=e.children.filter((e=>"fixed"!==e.position&&"sticky"!==e.position||(r.children.push(e),!1))),e!==t&&(e.children=e.children.filter((e=>"absolute"!==e.position||(t.children.push(e),!1)))))},_markViewportChildren(e){e.vc=!0,(e.children||[]).forEach((e=>this._markViewportChildren(e)))},_cloneTree(e){if(!e)return e;const t={...e};return t.cr&&(t.cr={...t.cr}),t.children&&(t.children=t.children.map((e=>this._cloneTree(e)))),t.elements&&(t.elements=[...t.elements]),t},_mergeTreeNodes(e){let t=e.children||[];t.filter((e=>!e.type&&e.children.length>0)).forEach((t=>{this._mergeTreeNodes(t,e)})),t.filter((e=>e.children&&!e.multiblock)).forEach((e=>{t=[...t,...e.children],e.children=null}));let r=t.filter((e=>"text"===e.type));r.length>1&&(r=this._sortByLines(r),r=this._mergeTextNodes(r,e)),e.multiblock=t.some((e=>e.multiblock))||r.filter((e=>"text"===e.type)).length>1,t=[...t.filter((e=>"text"!==e.type)),...r],t=t.filter((e=>e.type||e.children&&e.children.length>0)),e.children=this._sortByLines(t)},_trimAllTextNodes(e){e.children&&e.children.filter((e=>!e.type)).forEach((e=>this._trimAllTextNodes(e))),e.children&&e.children.length>0&&(e.children.filter((e=>"text"===e.type)).filter((e=>e.value)).forEach((e=>e.value=e.value.trim())),e.children=e.children.filter((e=>"text"!==e.type||e.value)))},_sortTree(e){e.children&&(e.children=this._sortByLines(e.children),e.children.forEach((e=>this._sortTree(e))))},_sortByLines(e){return e.sort(((e,t)=>{if(e.vc&&!t.vc)return-1;if(t.vc&&!e.vc)return 1;if(!e.cr)return 1;if(!t.cr)return-1;if(e.cr.bottom<t.cr.top)return-1;if(t.cr.bottom<e.cr.top)return 1;if(e.cr.lineShift||t.cr.lineShift||!(e.cr.top>=t.cr.top&&t.cr.bottom>=e.cr.bottom||t.cr.top>=e.cr.top&&e.cr.bottom>=t.cr.bottom)){const r=this._nodeLineHeight(e);if(e.cr.top+2/3*r<t.cr.top)return-1;const n=this._nodeLineHeight(t);if(t.cr.top+2/3*n<e.cr.top)return 1}else;const r=e.cr.left+(e.cr.lineShift||0),n=t.cr.left+(t.cr.lineShift||0);return r<n?-1:n<r?1:0}))},_mergeContentRects(e){if(0===(e=e.filter((e=>e.cr))).length)return null;if(1===e.length)return e[0].cr;let{top:t,right:r,bottom:n,left:i}=e[0].cr;for(let s=1;s<e.length;s++){const o=e[s];t=Math.min(o.cr.top,t),r=Math.max(o.cr.right,r),n=Math.max(o.cr.bottom,n),i=Math.min(o.cr.left,i)}return{top:t,right:r,bottom:n,left:i}},_dropEmptyNodes(e){return!!(e.children&&e.children.length>0)&&(e.children=e.children.filter((t=>t.type||this._dropEmptyNodes(t,e))),e.children.length>0)},_extractNumericNodes(e,t={}){if(!t.extract)return;const n=e.children;if(n)for(let e=0;e<n.length;e++){const s=n[e];if(!s.type){this._extractNumericNodes(s,t);continue}if("text"!==s.type)continue;const o=r.extractor.extract(s.value),a=o.items;if(0===a.length)continue;s.template=o.template;const l={};a.forEach((e=>l[e.type]=(l[e.type]||0)+1));const c={},h=s.elements.map((e=>e.textContent));h.forEach((e=>c[e]=(c[e]||0)+1)),this._injectDotIntoPrices(s,a),a.forEach((t=>{const r={...t};if(r.cr=s.cr,r.context=s.value,r.elements=s.elements,s.vc&&(r.vc=!0),n.splice(++e,0,r),1===l[t.type])return;if(c[t.content]>1)return;const o=s.elements.filter(((e,r)=>h[r].includes(t.content)));1===o.length&&(r.elements=o,r.container=o[0],r.container.nodeType===i&&(r.container=r.container.parentElement))}))}},_injectDotIntoPrices(e,r){const{elements:n}=e;if(n.length<=1)return;const i=r.map((e=>"price"===e.type&&e.value%1==0?e:null));if(!i.some((e=>!!e)))return;let s=-1;for(let e=0;e<n.length-1;e++){if(t.inspector.fontSize(n[e])<=t.inspector.fontSize(n[e+1])+1)continue;const o=n[e].textContent;if(!/\d$/.test(o))continue;const a=n[e+1].textContent;if(!/^\d\d?(?:\D|$)/.test(a))continue;const l=o.replaceAll(/\D/g,""),c=/^\d\d/.test(a)?a.slice(0,2):a.slice(0,1),h=l+c;for(let e=s+1;e<r.length;e++){if(!i[e])continue;if(!String(i[e].value).endsWith(h))continue;let t=String(i[e].value);const r=t.length,n=c.length;t=t.slice(0,r-n)+"."+t.slice(r-n),i[e].value=Number(t),s=e;break}}},_addContainer(e){e.children.forEach((e=>{const r=t.inspector.commonParentNode(e.elements);e.container=t.inspector.toElement(r)}))},_addAtSiblingIndex(e){for(let t=0;t<e.children.length;t++){const{container:r,type:n}=e.children[t];let i=0;for(let s=t-1;s>=0;s--){const t=e.children[s];if(t.container!==r&&!r.contains(t.container))break;t.type===n&&i++}e.children[t].at=i}},_addMarkdown(e){const r={H1:"# ",H2:"## ",H3:"### ",H4:"#### ",H5:"##### ",H6:"###### ",LI:"- "},n=e=>{for(;null!==e;){if(e.tagName&&r[e.tagName])return r[e.tagName];e=e.parentNode}return 0};for(let t=0;t<e.children.length;t++){const r=e.children[t];if("link"===r.type&&r.value){const e=(r.content||r.value).replaceAll("[","%5B").replaceAll("]","%5D"),t=r.value.replaceAll("(","%28").replaceAll(")","%29");r.md=`[${e}](${t})`}else if("text"===r.type&&r.value){const e=n(r.elements[0]);e&&(r.md=`${e}${r.value}`)}}const i=t.page._inputElement,s=i?.value||i?.innerText||i?.textContent||"";if(s.trim()){const r=`<USERINPUT ${i.name?` name="${i.name}"`:""}${i.placeholder?` placeholder="${i.placeholder}"`:""}/>${s}</USERINPUT>`,n=e.children.find((e=>i===e.elements[0]||i.contains(e.elements[0])));n?n.md=r:e.children.push({type:"text",elements:[i],cr:t.inspector.contentRect(i),md:r,value:s})}},_inspectNodes(e,r,n={}){if(!n.inspect&&!n.computeAiLocator)return;const i=e.children.map((e=>e.container)),s=t.inspector.inspect(i,{...n,parsedPage:r});e.children.forEach(((e,t)=>{e.data=s[t]}));for(let t=0;t<e.children.length;t++){const{data:r,type:n,at:i}=e.children[t];if(!r?.locator?.selector)continue;const s={$parse:n,at:i};r.locator.selector.push(s)}},_pruneTree(e,t){return e.type?e:(e.children&&(e.children=e.children.map((t=>this._pruneTree(t,e)))),t&&1===e.children.length?e.children[0]:e)},_flattenTree(e){const t=[],r=e=>{(e.children||[]).forEach((e=>{e.type?t.push(e):r(e)}))};return r(e),e.children=t,e},_reduceTree(e,t){t&&t!==w.body&&(e.children=e.children.filter((e=>e.elements.every((e=>t===e||t.contains(e))))))},_cleanupTree(e){e.children.forEach((e=>{delete e.multiblock,delete e.textContent}))},_addNodePath(e,t=[],r=0){e.path=[...t,r],e.children&&e.children.length>0&&e.children.forEach(((t,r)=>this._addNodePath(t,e.path,r)))},_mergeTextNodes(e,r){const n=[],s=e=>{if(r.vc&&!r.elements)return!1;let n=e.nodeType===i?e.parentElement:e;for(;n!==r.elements[0];){if("inline"!==t.inspector.style(n).display)return!1;n=n.parentElement}return!0},o=[];for(let t=0;t<e.length;t++){let r=t+1;for(;r<e.length;){const t=e[r-1],n=e[r];if(1===t.elements.length&&1===n.elements.length&&s(t.elements[0])&&s(n.elements[0])){r++;continue}if(n.cr.top-t.cr.bottom>=1)break;if(t.cr.top+2*this._nodeLineHeight(t)/3<n.cr.top){if(this._nodeLineHeight(t)!==this._nodeLineHeight(n))break}r++}o.push(e.slice(t,r)),t=r-1}const a=r.elements?t.inspector.style(r.elements[0])["white-space"]:null,l=["fontSize","color"];return o.forEach((e=>{if(1===e.length)return void n.push([e[0]]);let r=[];function i(){0!==r.length&&(n.push(r),r=[])}if((e=>{if(["pre-line","pre","pre-wrap","break-spaces"].includes(a))return!0;if(e.length<2)return!0;let t=e[0];for(let r=1;r<e.length;r++){const n=e[r];if(n.cr.top-t.cr.bottom<-1)return!0;t=n}return!1})(e=this._sortByLines(e))||(e=>{const r=e.map((e=>e.elements)).flat();if(r.length<2)return!0;const n=t.inspector.style(r[0]);for(let e=1;e<r.length;e++){const i=t.inspector.style(r[e]);if(i!==n)for(const e of l)if(n[e]!==i[e])return!1}return!0})(e)){for(let o=0;o<e.length;o++){const a=e[o];if(1===(s=a).elements.length&&["INPUT","TEXTAREA","SELECT"].includes(s.elements[0].tagName))i(),n.push([a]);else{if(o>0){const n=e[o-1],s=Math.max(this._nodeLineHeight(n),this._nodeLineHeight(a)),l=a.cr.top-n.cr.bottom,c=a.cr.left+(a.cr.lineShift||0)-n.cr.right;if(l<0&&c<0&&("absolute"===t.inspector.style(n.elements[0]).position||"absolute"===t.inspector.style(a.elements[0]).position)){i(),r.push(a);continue}if(c>=s/3){i(),r=[a];continue}if((c>1||l>-s/3)&&!a.value.startsWith(" ")&&!n.value.endsWith(" ")){r.push(" "),r.push(a);continue}}r.push(a)}}var s;r.length>0&&n.push(r)}else for(let t=0;t<e.length;t++)r.push(e[t]),i()})),n.map((e=>{const t=e.map((e=>"string"==typeof e?e:e.value)).join(""),r={type:"text",elements:e.filter((e=>"string"!=typeof e)).map((e=>e.elements)).flat(),cr:this._mergeContentRects(e),value:this._applyWhiteSpace(t,a)};return e.some((e=>e.vc))&&(r.vc=!0),r}))},_nodeLineHeight(e){const r=e.elements.filter((e=>!!e&&"string"!=typeof e));return 0===r.length?0:1===r.length?t.inspector.blockLineHeight(r[0]):r.map((e=>t.inspector.blockLineHeight(e))).reduce(((e,t)=>e>t?e:t))}}})(),(()=>{const{$engine:t,$bus:r}=e;t.pdf={CACHED_METHODS:["hasPdfDocument","isPdfDocument","getPdfUrl","pdfContent"],init(){t.memoizer.memoizeAll(this,this.CACHED_METHODS)},async hasPdfDocument(){const e=this.getPdfUrl();return!!e&&this.isPdfDocument(e)},async isPdfDocument(e){try{const t=await E(e,{method:"HEAD",credentials:"include",cache:"force-cache"});if(!t.ok)return!1;return"application/pdf"===t.headers.get("Content-Type")}catch(e){return!1}},getPdfUrl(){let e;const t=w.querySelector("pdf-viewer")?.shadowRoot?.querySelector("embed");return t&&(e=t.getAttribute("original-url")||t.getAttribute("src")),e||x.href||null},async pdfContent(){if(!await this.hasPdfDocument())return null;const e=this.getPdfUrl();if(!e)return null;let n;try{const t=await E(e,{credentials:"include",cache:"force-cache"});n=await t.blob()}catch(e){return t.warn("failed loading pdf document",e),null}return await r.send("engine.pdfToText",n)}}})(),(()=>{const{$engine:t,$utils:r}=e;function n(e){return Array.from(new Set(e))}function i(e){return e.includes("{{data}}")?e=>{const n=t.inspector.innerText(e);return(r.extractor.extract(n).template||n).trim()}:e=>(t.inspector.innerText(e)||"").trim()}t.query={init(){this.byCss=t.memoizer.memoize(this.byCss),this.byAll=t.memoizer.memoize(this.byAll),this.byXpath=t.memoizer.memoize(this.byXpath),this.byTag=t.memoizer.memoize(this.byTag),this.byClass=t.memoizer.memoize(this.byClass),this.byId=t.memoizer.memoize(this.byId),this.byRole=t.memoizer.memoize(this.byRole),this.byContent=t.memoizer.memoize(this.byContent),this.byText=t.memoizer.memoize(this.byText),this.byStyle=t.memoizer.memoize(this.byStyle),this._selectorMethods={$role:e=>this.byRole(e),$placeholder:e=>this.byPlaceholder(e),$text:e=>this.byText(e),$content:e=>this.byContent(e),$displayValue:e=>this.byDisplayValue(e),$altText:e=>this.byAltText(e),$title:e=>this.byTitle(e),$testId:e=>this.byTestId(e),$id:e=>this.byId(e),$tag:e=>this.byTag(e),$class:e=>this.byClass(e),$attribute:e=>this.byAttribute(e),$src:e=>this.bySrc(e),$style:e=>this.byStyle(e),$css:e=>this.byCss(e),$xpath:e=>this.byXpath(e),$anchor:(e,t)=>this.byAnchor(e,t)},this.cache=new Map},run(e,r={}){const n=r.multiple||r.mult||r.m;if(!e)return n?[]:null;if(e instanceof Element)return n?[e]:e;if("object"!=typeof e)throw new Error("locator must be a node or an object");const i=this._resolve(e.selector||e,!0);if(!n){const e=i.length;if(0===e)throw new Error("element not found");if(e>1)throw new Error(`${e} matching elements found`)}if(r.inspect||r.computeAiLocator){const e=t.serializer.elementData,n=t.inspector.inspect(i,r);i.forEach(((t,r)=>t[e]=n[r]))}return n?i:i[0]},_resolve(e,t=!1){return e?e instanceof c?[e]:r.is.array(e)?this._resolveFind({$find:e},t):r.is.array(e.$find)?this._resolveFind(e,t):r.is.array(e.$matches)?this._resolveMatches(e):this._resolveSelector(e,t):[]},_resolveSelector(e,t=!1){let n=[];r.is.string(e)&&!e.includes(": ")&&(e=e.startsWith("//")?{$xpath:e}:{$text:e});const i=Object.keys(e).filter((e=>e.startsWith("$")));if(0===i.length)return n;if(1===i.length){const t=this._selectorMethods[i[0]];if(!t)throw new Error(`selector ${i[0]} is not supported by query engine`);n=t(e[i[0]],e)}return i.length>1&&(n=this._resolveMatches({$matches:i.map((t=>({[t]:e[t]}))),type:"all"})),e.hasOwnProperty("traverse")&&(n=this._resolveTraverse(e.traverse,n)),e.hasOwnProperty("filter")&&(n=this._resolveFilter(e.filter,n)),e.hasOwnProperty("size")&&(n=this._resolveSize(e.size,n)),e.hasOwnProperty("at")&&(n=this._resolveAt(e.at,n)),e.hasOwnProperty("parse")&&(n=this._resolveParse(e,n,t)),n},_resolveMatches(e){const t=e.$matches;if(!t||0===t.length)return[];let r=[],n=new Map;for(const e of t){this._resolve(e).forEach((e=>{const t=n.get(e)||0;0===t&&r.push(e),n.set(e,t+1)}))}if(0===n.size)return[];const i=e.type||"most";if("most"===i){const e=Array.from(n.values()).reduce(((e,t)=>e>t?e:t));r=r.filter((t=>n.get(t)===e))}else if("any"===i);else if("all"===i)r=r.filter((e=>n.get(e)===t.length));else if("none"===i){const e=new Set(r);r=this.byAll().filter((t=>!e.has(t)))}const s=e.min||0;s>0&&(r=r.filter((e=>n.get(e)>=s)));const o=e.max||0;return o>0&&(r=r.filter((e=>n.get(e)<=o))),r},_resolveFind(e,t=!1){const r=e.$find;if(!r||0===r.length)return[];let i=[],s=new Set,o=0;for(const e of r)if(o++,e.hasOwnProperty("$at"))i=this._resolveAt(e.$at,i),s=n(i);else if(e.hasOwnProperty("$traverse"))i=this._resolveTraverse(e.$traverse,i),s=n(i);else if(e.hasOwnProperty("$filter"))i=this._resolveFilter(e.$filter,i),s=n(i);else if(e.hasOwnProperty("$size"))i=this._resolveSize(e.$size,i),s=n(i);else if(e.hasOwnProperty("$parse"))t=t&&o===r.length,i=this._resolveParse(e,i,t),s=n(i);else{this._resolve(e).filter((e=>!s.has(e))).forEach((e=>{i.push(e),s.add(e)}))}return i},_resolveAt:(e,t)=>("first"===e?e=0:"last"===e&&(e=t.length-1),e>=0&&e<t.length?[t[e]]:[]),_resolveTraverse(e,t){return"parent"===e?this.getParents(t):"children"===e?this.getChildren(t):"ancestors"===e?this.getAncestors(t):"descendants"===e?this.getDescendants(t):r.is.string(e)?(e=e.split(":").map((e=>Number(e))),this.traversePath(t,e)):r.is.array(e)?this.traversePath(t,e):[]},_resolveFilter(e,r){const n=r;if("roots"===(e=e.startsWith("not-")?e.slice(4):e)?r=this.filterRoots(r):"branches"===e?r=this.filterBranches(r):"leaves"===e?r=this.filterLeaves(r):"connected"===e?r=r.filter((e=>t.inspector.isConnected(e))):"visible"===e?r=r.filter((e=>t.inspector.isVisible(e))):"clickable"===e?r=r.filter((e=>t.inspector.isClickable(e))):"fixed"===e&&(r=r.filter((e=>t.inspector.isFixed(e)))),e.startsWith("not-")){const e=new Set(r);r=n.filter((t=>!e.has(t)))}return r},_resolveSize(e,t){r.is.number(e)&&(e={min:e,max:e});const{min:n,max:i,throws:s}=e,o=t.length,a=void 0!==n&&o<n||void 0!==i&&o>i;if(a&&!1!==s)throw 0===o?new Error("Element not found"):new Error(`Found ${o} matching elements`);return a?[]:t},_resolveParse(e,r,n=!1){if(0===(r=r||[w.body]).length)return[];r.length>1&&(r=this.filterRoots(r));const i=e.$parse??"*",s=e.at??"*";let o=0;const a=r.map((e=>{if("*"!==s&&s<o)return[];let r=t.parser.parse(e,{extract:!0});return"*"!==i&&(r=r.filter((e=>e.type===i))),o+=r.length,n?r:r.map((e=>e.container))})).flat();return"*"===s?a:s<0||s>=a.length?[]:[a[s]]},byCss(e=""){try{return Array.from(w.querySelectorAll(e))}catch(e){return[]}},byAll(){try{return Array.from(w.getElementsByTagName("*"))}catch(e){return[]}},byXpath(e="",t){t=t||w.documentElement;try{const r=w.evaluate(e,t,null,y.ORDERED_NODE_SNAPSHOT_TYPE,null),n=[];for(let e=0;e<r.snapshotLength;e++)n.push(r.snapshotItem(e));return n}catch(e){return[]}},byTag(e=""){try{return Array.from(w.getElementsByTagName(e))}catch(e){return[]}},byClass(e=""){try{return Array.from(w.getElementsByClassName(e))}catch(e){return[]}},byId(e=""){try{const t=w.getElementById(e);return t?[t]:[]}catch(e){return[]}},byAttribute(e=""){const t=e.indexOf("=");return-1!==t?this.byCss(`*[${e.slice(0,t)}="${e.slice(t+1)}"]`):this.byCss(`*[${e}]`)},byAltText(e=""){return this.byCss(`*[alt="${e}"]`)},byDisplayValue(e=""){return this.byCss("input,textarea,select").filter((t=>"SELECT"===t.tagName?Array.from(t.options).filter((e=>e.selected)).map((e=>e.textContent)).join(" & ")===e:t.value===e))},byRole(e=""){if(!e)return[];const r=["*[role]",...Object.keys(t.tagsToRoles)].join(",");return Array.from(w.querySelectorAll(r)).filter((r=>{const n=t.inspector.role(r);return!!n&&("*"===e||n.split(" ").some((t=>t===e)))}))},byText(e=""){if(e.length<1)return[];const n=r.string.toRegex(e),s=i(e);let o=[w.body];const a=[];for(;o.length>0;){const e=o.shift(),i=s(e),l=r.occurrences.regex(i,n);if(0===l)continue;let c=0;const h=t.inspector.innerText(e),m=Array.from(e.children).filter((e=>h.includes(t.inspector.innerText(e)))).map((e=>{const t=r.occurrences.regex(s(e),n);return c+=t,t>0?{child:e,occurrences:t}:null})).filter((e=>Boolean(e)));l>c&&a.push(e),m.length>0&&(o=o.concat(m.map((e=>e.child))))}return a},byContent(e=""){if(e.length<1)return[];const n=r.string.toRegex(e),s=i(e);let o=[w.body];const a=[];for(;o.length>0;){const e=o.shift();if(0===r.occurrences.regex(s(e),n))continue;a.push(e);const i=t.inspector.innerText(e),l=Array.from(e.children).filter((e=>i.includes(t.inspector.innerText(e)))).filter((e=>0!==r.occurrences.regex(s(e),n)));l.length>0&&(o=o.concat(l))}return a},byPlaceholder(e=""){return this.byCss(`*[placeholder="${e}"]`)},byTestId(e=""){return this.byCss(`*[data-testid="${e}"]`)},byTitle(e=""){return this.byCss(`*[title="${e}"]`)},bySrc(e=""){return this.byCss(`*[src="${e}"]`)},byStyle(e=""){let[r,n]=e.split("=");e.includes("=")||(n=e,r=null);return t.query.byAll().filter((e=>t.inspector.styleHash(e,r)===n))},byAnchor(e="",t){if(!e)throw new Error("anchor selector value must be provided");const r=this._resolve(e);return 0===r.length?[]:t.shift?this._byAnchorShifted(r,t):this._byAnchorClosest(r,t)},_byAnchorShifted(e,n){const i=this.byAll();if(0===i.length)return[];let s=new Map;const o=r.is.string(n.shift)?n.shift.split(":").map((e=>Number(e)||0)):n.shift,[a,l]=o;if(e.forEach((e=>{let r=t.inspector.anchorPoint(e);r={x:r.x+a,y:r.y+l},i.filter((e=>t.inspector.rect(e).covers(r.x,r.y))).filter((t=>t!==e&&!t.contains(e)&&!e.contains(t))).map((e=>{const n=s.get(e)||Number.MAX_VALUE,i=t.inspector.distance(r,e);s.set(e,Math.min(i,n))}))})),s=Array.from(s.entries()),0===s.length)return[];return s.sort(((e,r)=>e[1]!==r[1]?e[1]-r[1]:t.inspector.path(r[0]).length-t.inspector.path(e[0]).length)),s.map((e=>e[0]))},_byAnchorClosest(e){let r=[];return e.forEach((e=>{let n=e.parentElement;for(;n;){const i=Array.from(n.children).filter((e=>Boolean(t.inspector.innerText(e)))).filter((t=>t!==e&&!t.contains(e))).filter((e=>t.inspector.isVisible(e)));if(i.length>0){i.forEach((n=>r.push({n:n,d:t.inspector.distance(e,n)})));break}n=n.parentElement}})),0===r.length?[]:1===r.length?[r[0].n]:[r.reduce(((e,t)=>t.d<e.d?t:e)).n]},getParents:e=>n(e.map((e=>e.parentNode)).filter(Boolean)),getChildren:e=>n(e.map((e=>Array.from(e.children))).flat()),getDescendants:e=>n(e.map((e=>Array.from(e.getElementsByTagName("*")))).flat()),getAncestors(e){const t=new Set;return e.forEach((e=>{let r=e;for(;r;)t.add(r),r=r.parentNode})),Array.from(t)},traversePath:(e,t)=>n(e.map((e=>{for(let r of t){if(!e)return null;if(r>=0)e=e.children[r];else for(;r++<0;)if(!(e=e.parentNode))return null}return e})).filter((e=>Boolean(e)))),filterRoots(e){const t=new Set(e);return e.filter((e=>{for(e=e.parentNode;e;){if(t.has(e))return!1;e=e.parentNode}return!0}))},filterBranches(e){const t=new Set(this.filterRoots(e)),r=new Set(this.filterLeaves(e));return e.filter((e=>!t.has(e)&&!r.has(e)))},filterLeaves(e){const t=new Set(e);return e.map((e=>e.parentNode)).forEach((e=>{for(;e;)t.delete(e),e=e.parentNode})),Array.from(t)}}})(),(()=>{const{$engine:t}=e;t.rectUtils={merge(e,r){if(e.length<1)return null;const n=t.Rect.of(e[0]);return e.length>1&&e.forEach((e=>{e.top<n.top&&(n.top=e.top),e.bottom>n.bottom&&(n.bottom=e.bottom),e.left<n.left&&(n.left=e.left),e.right>n.right&&(n.right=e.right)})),r&&(n.top-=r.top,n.right+=r.right,n.bottom+=r.bottom,n.left-=r.left),n},recombine(e){if(e.length<2)return e;e=[...e].sort(((e,t)=>e.top-t.top));for(let t=0;t<e.length-1;t++)for(let r=t+1;r<e.length;r++){const n=e[t],i=e[r];if(n.bottom<=i.top)break;if(this.contains(n,i))e.splice(r,1),r--;else if(this.contains(i,n)){e.splice(t,1),t--;break}}for(let t=0;t<e.length-1;t++)for(let r=t+1;r<e.length;r++){const n=e[t],i=e[r];if(n.bottom<=i.top)break;if(this.overlaps(n,i)){e.splice(r,1),e.splice(t,1,...this._breakOverlap(n,i)),e=e.sort(((e,t)=>e.top-t.top)),t--;break}}return e},intersect:(e,r)=>new t.Rect(Math.max(e.top,r.top),Math.min(e.right,r.right),Math.min(e.bottom,r.bottom),Math.max(e.left,r.left)),intersectByX:(e,r)=>new t.Rect(e.top,Math.min(e.right,r.right),e.bottom,Math.max(e.left,r.left)),intersectByY:(e,r)=>new t.Rect(Math.max(e.top,r.top),e.right,Math.min(e.bottom,r.bottom),e.left),contains:(e,t)=>!(t.top<e.top||t.bottom>e.bottom||t.left<e.left||t.right>e.right),overlaps:(e,t)=>!(e.top>=t.bottom||t.top>=e.bottom)&&!(e.left>=t.right||t.left>=e.right),_breakOverlap(e,r){const n=[e.top,r.top,e.bottom,r.bottom],i=[e.left,r.left,e.right,r.right];return[new t.Rect(n[0],i[1],n[1],i[0]),new t.Rect(n[0],i[2],n[1],i[1]),new t.Rect(n[0],i[3],n[1],i[2]),new t.Rect(n[1],i[1],n[2],i[0]),new t.Rect(n[1],i[2],n[2],i[1]),new t.Rect(n[1],i[3],n[2],i[2]),new t.Rect(n[2],i[1],n[3],i[0]),new t.Rect(n[2],i[2],n[3],i[1]),new t.Rect(n[2],i[3],n[3],i[2])].filter((e=>e.top<e.bottom&&e.left<e.right)).filter((t=>this.overlaps(t,e)||this.overlaps(t,r)))}}})(),(()=>{const{$engine:t}=e;t.Rect=class{constructor(e,t,r,n){this.top=e,this.right=t,this.bottom=r,this.left=n}get x(){return this.left}set x(e){this.left=e}get y(){return this.top}set y(e){this.top=e}get width(){return this.right-this.left}get height(){return this.bottom-this.top}get cx(){return this.left+(this.right-this.left)/2}get cy(){return this.top+(this.bottom-this.top)/2}clone(){return new t.Rect(this.top,this.right,this.bottom,this.left)}shift(e,t){return e=e||0,t=t||0,this.top+=t,this.right+=e,this.bottom+=t,this.left+=e,this}covers(e,t){return this.top<=t&&t<=this.bottom&&this.left<=e&&e<=this.right}serialize(){return{top:this.top,right:this.right,bottom:this.bottom,left:this.left}}static of(e){if(!e)return e;let{top:r,right:n,bottom:i,left:s,x:o,y:a,width:l,height:c}=e;return r=(void 0!==r?r:a)||0,s=(void 0!==s?s:o)||0,n=void 0!==n?n:s+(l||0),i=void 0!==i?i:r+(c||0),new t.Rect(r,n,i,s)}}})(),(()=>{const{$engine:t,$utils:r}=e;t.screenshotter={init(){this._dpr=1,this._quality=.7,this._emptySegmentsConfig={xStep:5,yStep:5,dominantThreshold:.95,emptySegmentMinHeightPx:700},this._running=!1,this._document=null,this._fullPage=!1,this._fnCache=new Map,this._styleCache=new Map,this._elementsMap=new Map,this._fetchPromises=new Map,this._svgToImagePromise=null,this._fetch=this._makeCacheable(this._fetch,"fetch"),this._toDataUrl=this._makeCacheable(this._toDataUrl,"toDataUrl")},async capture({fullPage:e=!1},t){if(this._running)throw new Error("already running");this._running=!0,this._fullPage=e,this._initDocument(),await new Promise((async e=>{const r=t.startedAt+t.timeout-Date.now()-2e3,n=setSafeTimeout(e,r);await this._waitAll([this._inlineStyles(),this._inlineImages(),this._inlineVideos(),this._inlineFrames(),this._inlineCanvases(),this._inlineControls()]),clearSafeTimeout(n),e()}));try{this._removeComments(),this._removeElements(),this._removeInvalidAttributes(),this._disableAnimations(),this._emulateScrolls(),this._preloadFonts(),this._fixVwAndVh(),this._fixZIndex()}catch(e){s.error(e)}const r=await this._documentToImage();return this._document=null,this._fnCache.clear(),this._styleCache.clear(),this._elementsMap.clear(),this._fetchPromises.clear(),this._svgToImagePromise=null,this._running=!1,r},onFetchResponse({id:e,data:t}){this._fetchPromises.get(e).resolve(t)},onSvgToImageResponse(e){this._svgToImagePromise&&this._svgToImagePromise.resolve(e)},_initDocument(){this._document=w.cloneNode(!0);const e=this._document.querySelectorAll("*");w.querySelectorAll("*").forEach(((t,r)=>{const n=e[r];this._elementsMap.set(t,n),this._elementsMap.set(n,t)}))},async _inlineStyles(){let e,t,r,n;{const r="__hrp:single-quote__",n="__hrp:double-quote__";e=e=>e.replaceAll("\\'",r).replaceAll('\\"',n),t=e=>e.replaceAll(r,"\\'").replaceAll(n,'\\"')}{const e=(e="",t="")=>new RegExp(`${`${e}url\\(\\s*'([^']+)'\\s*\\)${t}`}|${`${e}url\\(\\s*"([^"]+)"\\s*\\)${t}`}|${`${e}url\\(\\s*([^'") ]+)\\s*\\)${t}`}`,"g");r=e("",""),n=e("@import\\s+","\\s*;")}const i=(e,r)=>Array.from(e.matchAll(r)||[]).map((([e,r,n,i])=>{const s=t(r||n||i||"");return s?[e,s]:null})).filter(Boolean),s=async(t,r)=>{const o=i(t,n);return await this._waitAll(o.map((async([n,i])=>{let o=await this._fetch({url:i,root:r,method:"text"});o=e(o),o=await s(o,r),t=t.replaceAll(n,o)}))),t};await this._waitAll([...w.styleSheets].map((async n=>{const o=n.ownerNode,a=this._elementsMap.get(o);let l,c;if(n.href){if(c=n.href.split("/").slice(0,-1).join("/"),l=await this._fetch({url:n.href,method:"text"}),!l)return}else{c="/";const e=a.textContent,t=[...n.cssRules].map((e=>e.cssText)).join("");l=`${e}\n${t}`}l=await s(l,c),l=l.replaceAll(":root","html:is(html)").replace(/body\s*::?\s*-webkit-scrollbar/g,"foreignObject::-webkit-scrollbar").replace(/env\([^)]+\)/g,"0"),l=e(l);const h=i(l,r);await this._waitAll(h.map((async([e,t])=>{const r=await this._toDataUrl(t,c);l=l.replaceAll(e,`url("${r}")`)}))),l=t(l);const m=this._createElement("style");m.media=a.media,m.textContent=l,this._replaceElement(a,m)})))},async _inlineImages(){await this._waitAll(this._queryAll("*").map((async e=>{const t=this._getTagName(e),r=this._getStyle(e);if("img"===t){const t=this._getSource(e),n=await this._toDataUrl(t.currentSrc);e.removeAttribute("srcset"),e.setAttribute("src",n),this._setStyle(e,{width:r.width,height:r.height})}if(r.backgroundImage.startsWith("url(")){const t=r.backgroundImage.slice(r.backgroundImage.indexOf('"')+1,r.backgroundImage.lastIndexOf('"')),n=await this._toDataUrl(t);this._getStyle(e,{"background-image":`url("${n}")`,"background-size":r.backgroundSize})}if("use"===t){const t=e.getAttribute("href")||e.getAttribute("xlink:href");if(t&&t.indexOf("#")>0){const[r,n]=t.split("#"),i=await this._toDataUrl(r);e.setAttribute("href",`${i}#${n}`),e.removeAttribute("xlink:href")}}})))},async _inlineVideos(){await this._waitAll(this._queryAll("video").map((async e=>{const t=this._getSource(e),r=this._getStyle(e);if(!(t.currentSrc&&t.videoWidth>0&&t.videoHeight>0))return;const n=async e=>{const n=w.createElement("canvas");n.width=parseFloat(r.width),n.height=parseFloat(r.height);const i=n.getContext("2d"),s=t.videoWidth,o=t.videoHeight,a=n.width,l=n.height;i.drawImage(e,0,0,s,o,0,0,a,l);const c=await this._canvasToObjectUrl(n);return await this._toDataUrl(c)};let i;try{i=await n(t)}catch{const e=w.createElement("video");e.crossOrigin="anonymous",e.setAttribute("src",t.currentSrc),await new Promise(((t,r)=>{e.onloadedmetadata=t,e.onerror=e=>r(["failed to load video metadata",e])})),e.currentTime=t.currentTime,await new Promise(((t,r)=>{e.ontimeupdate=t,e.onerror=e=>r(["failed to update time",e])})),i=await n(e)}const s=this._createElement("img"),o=this._styleToCssText(r);s.setAttribute("style",o),s.src=i,this._replaceElement(e,s)})))},async _inlineFrames(){await this._waitAll(this._queryAll("iframe").map((async e=>{const t=this._getStyle(e),r=this._styleToCssText(t),n=this._createElement("div");n.setAttribute("style",r),this._setStyle(n,{background:"rgb(128 128 128 / 18%)"}),"inline"===t.display&&this._setStyle(n,{display:"inline-block"}),this._replaceElement(e,n)})))},async _inlineCanvases(){await this._waitAll(this._queryAll("canvas").map((async e=>{const t=this._getSource(e),r=this._getStyle(t),n=this._styleToCssText(r),i=this._createElement("img");i.setAttribute("style",n),i.src=t.toDataURL("image/webp",this._quality),this._replaceElement(e,i)})))},async _inlineControls(){await this._waitAll(this._queryAll("option, textarea, input").map((async e=>{const t=this._getTagName(e);if("option"!==t){if("textarea"===t){const t=e.value,r=w.createTextNode(t);return e.innerHTML="",void e.appendChild(r)}if("input"===t)if("radio"===e.type||"checkbox"===e.type)e.toggleAttribute("checked",e.checked);else if("image"===e.type&&e.src){const t=await this._toDataUrl(e.src);e.setAttribute("src",t)}else"color"!==e.type&&"date"!==e.type&&"datetime-local"!==e.type&&"email"!==e.type&&"month"!==e.type&&"number"!==e.type&&"password"!==e.type&&"range"!==e.type&&"search"!==e.type&&"tel"!==e.type&&"text"!==e.type&&"time"!==e.type&&"url"!==e.type&&"week"!==e.type||(e.setAttribute("value",e.value),this._setStyle(e,{width:this._getStyle(e).width}))}else e.toggleAttribute("selected",e.selected)})))},_removeComments(){const e=this._document.createTreeWalker(this._document,h.SHOW_COMMENT),t=[];for(;;){const r=e.nextNode();if(!r)break;t.push(r)}for(const e of t)e.remove()},_removeElements(){this._queryAll("meta").forEach((e=>e.remove())),this._queryAll("link").forEach((e=>e.remove())),this._queryAll("script").forEach((e=>e.remove())),this._queryAll("source").forEach((e=>e.remove())),this._queryAll("noscript").forEach((e=>e.remove())),this._queryAll("__hrp__").forEach((e=>e.remove())),this._queryAll("*").map((e=>{e.tagName.includes(":")&&e.remove()}))},_removeInvalidAttributes(){const e=e=>"elementtiming"!==(e=e.toLowerCase())&&(/^[a-z]+[a-z0-9-_]*$/.test(e)||e.startsWith("xlink:"));this._queryAll("*").map((t=>{const r=t.getAttributeNames();for(const n of r)e(n)||t.removeAttribute(n)}))},_disableAnimations(){const e=this._createElement("style");this._document.head.append(e),e.textContent="\n          * {\n            animation: none !important;\n            transition: none !important;\n          }\n        "},_emulateScrolls(){const e=(e,t)=>e.includes("px")?parseFloat(e)-t+"px":"auto";this._queryAll("*").forEach((t=>{if(this._fullPage&&t===this._document.body)return;if(this._fullPage&&t===this._document.documentElement)return;const r=this._getSource(t);if(!r)return;if(!(r.scrollTop>0||r.scrollLeft>0))return;let n=t.children;t===this._document.documentElement&&(n=this._document.body.children);for(const i of n){const n=this._getStyle(i),s=n.position;"static"===s?this._setStyle(t,{top:`-${r.scrollTop}px`,left:`-${r.scrollLeft}px`,right:"auto",bottom:"auto",position:"relative"}):"absolute"!==s&&"relative"!==s||this._setStyle(i,{top:e(n.top,r.scrollTop),left:e(n.left,r.scrollLeft),right:e(n.right,r.scrollLeft),bottom:e(n.bottom,r.scrollTop)})}}))},_preloadFonts(){const e=new Set;for(const t of w.querySelectorAll("*")){this._getStyle(t).fontFamily.split(",").map((e=>e.trim().replaceAll('"',"'").toLowerCase())).forEach((t=>e.add(t)))}const t=`\n          <div style="position: fixed; left: -100000px">\n            ${[...e].map((e=>`<div style="font-family: ${e}">a</div>`)).join("")}\n          </div>\n        `;this._document.body.insertAdjacentHTML("beforebegin",t)},_fixVwAndVh(){if(!this._fullPage)return;const e=["background-image"],t=e=>/\d+vw/.test(e)||/\d+vh/.test(e),r=this._queryAll("body *");r.forEach((r=>{const n=[...r.style];for(const i of n){if(e.includes(i))continue;const n=r.style[i];t(n)&&this._setStyle(r,{[i]:this._getStyle(r)[i]})}}));for(const n of this._queryAll("style"))for(const i of n.sheet.cssRules){if(!i.styleMap)continue;const n=[];for(const[r,s]of i.styleMap)e.includes(r)||t(s.toString())&&n.push(r);if(0===n.length)continue;const s=r.filter((e=>e.matches(i.selectorText)));for(const e of s)for(const t of n)this._setStyle(e,{[t]:this._getStyle(e)[t]})}},_fixZIndex(){const e=e=>parseInt(this._getStyle(e).zIndex)||0;this._document.querySelectorAll("body, body *").forEach((t=>{if(e(t)>=0)return;const r=t.parentElement.parentElement;for(const t of r.children)this._setStyle(t,{"z-index":e(t)})}))},async _documentToImage(){let e,i;this._fullPage?(e=n.innerWidth,i=Math.max(w.body.scrollHeight,w.documentElement.scrollHeight)):(e=n.innerWidth,i=n.innerHeight);const s=this._document.documentElement;s.removeAttribute("xmlns");let o=(new g).serializeToString(s);const a='xmlns:xlink="http://www.w3.org/1999/xlink"';o=o.replaceAll(`${a} ${a}`,a);const l=this._getStyle(this._document.body),c=this._getStyle(s),h="rgba(0, 0, 0, 0)"===l.backgroundColor?c.backgroundColor:l.backgroundColor,m=`\n          <svg\n            xmlns="http://www.w3.org/2000/svg"\n            width="${e}"\n            height="${i}"\n            viewBox="0 0 ${e} ${i}"\n            style="font-size: ${c.fontSize}">\n            <foreignObject\n              width="${e}"\n              height="${i}"\n              style="\n                overflow-x: ${l.overflowX};\n                overflow-y: ${l.overflowY};\n                background: ${h};\n              ">\n              ${o}\n            </foreignObject>\n          </svg>\n        `.trim();this._svgToImagePromise=r.createPromise(),t.injection.sendEvent("screenshotter.svgToImage",{dpr:this._dpr,width:e,height:i,svgCode:m,quality:this._quality});return await this._svgToImagePromise},_removeEmptySegments(e){const{xStep:t,yStep:r,dominantThreshold:n,emptySegmentMinHeightPx:i}=this._emptySegmentsConfig,s=e.width,o=e.height,a=e.getContext("2d"),l=a.getImageData(0,0,s,o).data,c=[];for(let e=0;e<l.length;e+=4*t){const t=`${l[e]},${l[e+1]},${l[e+2]},${l[e+3]}`,r=Math.floor(e/4/s);c[r]||(c[r]=[]),c[r].push(t)}const h=[];for(let e=0;e<o;e+=r){let t=0,i=null;const s={},o=c[e];for(const e of o){const r=(s[e]||0)+1;s[e]=r,t>r||(i=e,t=r)}const a=h.at(-1),l=t/o.length>n?i:null;a&&a.color===l?a.height+=r:h.push({index:e,height:1,color:l})}const m=[];for(const e of h)e.color&&(e.height<i||m.push({start:e.index*s*4,size:e.height*s*4,height:e.height}));if(0!==m.length){let t=e.height;if(m.forEach((e=>t-=e.height)),t<=0)return;e.height=t;const r=Array.from(l);for(const e of m.reverse())r.splice(e.start,e.size);const n=a.createImageData(s,e.height);for(let e=0;e<r.length;e+=1)n.data[e]=r[e];a.putImageData(n,0,0)}},async _waitAll(e){const t=await Promise.allSettled(e);for(const e of t)"rejected"===e.status&&s.error(e.reason)},_getStyle(e){const t=this._getSource(e);return t?(this._styleCache.has(t)||this._styleCache.set(t,T(t)),this._styleCache.get(t)):e.style},_styleToCssText(e){let t=[...e].map((t=>`${t}: ${e[t]};`)).join("");return t+="flex-shrink: 0;",t},_getSource(e){return w.contains(e)?e:this._elementsMap.get(e)||null},_getTagName:e=>e.tagName.toLowerCase(),_queryAll(e){return[...this._document.querySelectorAll(e)]},_createElement(e){return this._document.createElement(e)},_makeCacheable(e,t){return async(...n)=>{const i=`${t}-${JSON.stringify(n)}`;if(this._fnCache.has(i))return this._fnCache.get(i);const s=r.createPromise();let o;this._fnCache.set(i,s);try{o=await e.call(this,...n),s.resolve(o)}catch(e){throw s.reject(e),e}return o}},async _fetch({url:e,root:n=x.href,method:i="blob"}){let s;e=this._toFullUrl(e,n);try{s=await E(e)}catch{}if(s?.ok){try{return await s[i]()}catch{}if("blob"===i){s=await E(e);const t=s.headers.get("content-type").split(";")[0],r=await s.text();return new o([r],{type:t})}}const a=`${Date.now()}:${Math.random()}`,l=r.createPromise();return this._fetchPromises.set(a,l),t.injection.sendEvent("screenshotter.fetch",{id:a,url:e,method:i}),l},async _toDataUrl(e,t=x.href){if(!e)return"";if(e.startsWith("data:"))return e;const r=await this._fetch({url:e,root:t,method:"blob"});if("string"==typeof r&&r.startsWith("data:"))return r;if(!(r&&r instanceof o))return"";return await new Promise(((e,t)=>{const n=new a;n.onerror=t,n.onload=()=>e(n.result),n.readAsDataURL(r)}))},async _canvasToBlob(e){return r.canvasToBlob(e,"image/webp",this._quality)},async _canvasToObjectUrl(e){const t=await this._canvasToBlob(e);return p.createObjectURL(t)},_toFullUrl(e,t=x.href){try{return new p(e),e}catch{}return e.startsWith("//")?x.protocol+e:e.startsWith("/")?x.origin+e:`${this._toFullUrl(t)}/${e}`},_setStyle(e,t){for(const r in t){const n=t[r];e.style.setProperty(r,n,"important")}},_replaceElement(e,t){const r=this._getSource(e);this._elementsMap.delete(e),this._elementsMap.set(r,t),this._elementsMap.set(t,r),e.replaceWith(t)}}})(),(()=>{const{$engine:t}=e;t.scroller={async scroll(e="bottom",t={}){if("all"===(e=e||"bottom")){let e=null;do{if(e=n.scrollY,await this.scroll("viewport",t),t.timeout&&t.startedAt&&t.timeout>0&&Date.now()-t.startedAt>t.timeout)return this.getScrollPosition()}while(e!==n.scrollY);return this.getScrollPosition()}if("object"==typeof e&&!e.hasOwnProperty("x")&&!e.hasOwnProperty("y"))return this.scrollIntoView(e,t);if("top"===e?e={x:n.scrollX,y:0}:"bottom"===e?e={x:n.scrollX,y:w.documentElement.scrollHeight}:"viewport"===e&&(e={x:n.scrollX,y:n.scrollY+n.innerHeight}),"object"!=typeof e&&!e.hasOwnProperty("x")&&!e.hasOwnProperty("y"))throw new Error('unsupported "to" parameter passed to scroll method');let{x:r,y:i}=e;return null==r&&(r=n.scrollX),null==i&&(i=n.scrollY),n.scrollTo({top:i,left:r}),await this.waitForNotScrolling(),{x:n.scrollX,y:n.scrollY}},async scrollIntoView(e,t){if(e&&e.isConnected&&(e.nodeType!==w.TEXT_NODE||(e=e.parentElement)))return e.scrollIntoView({block:t?.scrollBlock||"nearest",inline:t?.scrollInline||"nearest"}),await this.waitForNotScrolling(),this.getScrollPosition()},async waitForNotScrolling(){let e=n.scrollX,t=n.scrollY,r=0,i=0;for(;r<100&&r-i<20;)await new Promise((e=>setSafeTimeout(e,16))),n.scrollX===e&&n.scrollY===t||(i=r,e=n.scrollX,t=n.scrollY),r++},getScrollPosition:()=>({x:n.scrollX,y:n.scrollY})}})(),(()=>{const{$engine:t}=e;t.serializer={elementId:Symbol("element_id"),elementData:Symbol("element_data"),maxElementId:-1,elements:{},deserialize(e){if(!e)return e;if("function"==typeof e)return e;if(e instanceof o)return e;if(Array.isArray(e))return e.map((e=>this.deserialize(e)));const t=e.__$ht;if(t){if("error"===t){const t=new Error(e.message);return Object.keys(e).filter((e=>"__$ht"!==e)).forEach((r=>{t[r]=e[r]})),t}if("element"===t)return this.elements[e.id];if("date"===t)return new Date(e.time)}if("object"==typeof e){const t={};for(const r in e)t[r]=this.deserialize(e[r]);return t}return e},serialize(e){if(!e)return e;if(e instanceof o)return p.createObjectURL(e);if(Array.isArray(e))return e.map((e=>this.serialize(e)));if(e instanceof Error){const t={__$ht:"error",message:e.message,stack:e.stack};return Object.keys(e).forEach((r=>{t[r]=e[r]})),t}if(e instanceof t.Rect)return e.serialize();if(e instanceof m)return Array.from(e).map((e=>this.serialize(e)));if(e instanceof c){e[this.elementId]||(e[this.elementId]=++this.maxElementId,this.elements[this.maxElementId]=e);const t={__$ht:"element",id:e[this.elementId]};return e[this.elementData]&&(t.data=this.serialize(e[this.elementData])),t}if(e instanceof Date)return{__$ht:"date",time:e.getTime()};if("object"==typeof e){const t={};return Object.keys(e).forEach((r=>{t[r]=this.serialize(e[r])})),t}return e}}})(),(()=>{const{$engine:t}=e;t.simulator={init(){this.eventMatchers={HTMLEvents:new Set(["load","unload","abort","error","select","change","submit","reset","focus","blur","resize","scroll","input"]),MouseEvents:new Set(["click","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout"]),KeyboardEvents:new Set(["keydown","keyup","keypress"])}},async click(e,r){this._sendEvent(e,"mouseover"),await t.waiter.wait(50);const n=this._changeLinkTarget(e,"_blank","_self");this._sendEvent(e,"mousedown",r),this._sendEvent(e,"focus"),await t.waiter.wait(50),this._sendEvent(e,"mouseup",r),this._sendEvent(e,"click",r),this._changeLinkTarget(n,"_self","_blank")},async paste(e,r,n="insert",i=null){w.body.focus({preventScroll:!0});if("insert"===n)e.focus(),r.length>0&&this._insertText(e,r);else if("replace"===n)e.focus(),w.execCommand("selectAll",null,null),w.execCommand("delete",null,null),r.length>0&&this._insertText(e,r);else{if("type"!==n)throw new Error(`unsupported paste mode ${n}`);e.focus();for(let n=0;n<r.length;n++){const i=r[n];this._sendEvent(e,"keydown",{key:i}),await t.waiter.wait(20),this._sendEvent(e,"keypress",{key:i}),this._insertText(e,i),this._sendEvent(e,"input",{data:i}),await t.waiter.wait(20),this._sendEvent(e,"keyup",{key:i}),await t.waiter.wait(20)}e&&this._sendEvent(e,"change")}return await(async e=>{if(e&&(await t.waiter.wait(50),e.focus(),i))for(const r of["keydown","keypress","keyup"])this._sendEvent(e,r,{key:i}),await t.waiter.wait(20)})(e),{innerText:e.innerText}},_insertText(e,t){if("true"===e.contentEditable){const r=e.innerText;w.execCommand("insertHTML",null,t.replaceAll("\n","<br>")),e.innerText===r&&w.execCommand("insertText",null,t.replaceAll("\n"," "))}else w.execCommand("insertText",null,t)},_changeLinkTarget(e,t="_blank",r="_self"){if(!e||!e.isConnected)return;let n=e;do{if("A"===n.tagName)return n.getAttribute("target")===t&&n.setAttribute("target",r),n;n=n.parentNode}while(null!==n);return null},_eventType(e){for(const t in this.eventMatchers)if(this.eventMatchers[t].has(e))return t;throw new SyntaxError(`unsupported event name ${e}`)},_extend(e,t){for(let r in t)e[r]=t[r];return e},_defaultOptions(e){let t={ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0};if(e){const r=e.getBoundingClientRect(),i=n.pageXOffset||w.documentElement.scrollLeft,s=n.pageYOffset||w.documentElement.scrollTop;t={...t,screenX:r.left+r.width/2+i,screenY:r.top+r.height/2+s,clientX:r.left+r.width/2,clientY:r.top+r.height/2,button:0}}return t},_sendEvent(e,t,r={}){e=e||w.body;const n=this._eventType(t),i=this._defaultOptions(e),s=this._extend(i,r);let o;if(w.createEvent){if("HTMLEvents"===n)o=w.createEvent(n),o.initEvent(t,s.bubbles,s.cancelable);else if("MouseEvents"===n)o=w.createEvent(n),o.initMouseEvent(t,s.bubbles,s.cancelable,w.defaultView,s.button,s.screenX,s.screenY,s.clientX,s.clientY,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.button,e);else if("KeyboardEvents"===n){const n=r.key;o=new KeyboardEvent(t,{key:n,code:1===n.length?`Key${n.toUpperCase()}`:n.charAt(0).toUpperCase()+n.slice(1),keyCode:{Enter:13,Backspace:8,Tab:9,Space:32,Delete:46,Escape:27,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Home:36,End:35,PageUp:33,PageDown:34}[n]||n.charCodeAt(0),char:n,charCode:n.charCodeAt(0),which:n.charCodeAt(0),currentTarget:e,view:w.defaultView,altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,isTrusted:!0})}e.dispatchEvent(o)}return e}}})(),(()=>{const{$engine:t}=e;t.state={init(){this._observers=new Set,this._state={}},getState(){return this._state},apply(e){this._modify((()=>this._state=e))},observe(e){return this._observers.add(e),()=>this._observers.delete(e)},transaction(e){this._modify((()=>e(this._state))),t.frame.send("engine.syncState",this._state)},_modify(e){e();for(const e of this._observers)e(this._state)}}})(),(()=>{const{$engine:t}=e;t.timer={init(){this.MAX_ID=2147483647,this.lastId=0,this.idToCallback={},this._patchMethods()},_generateId(){do{this.lastId===this.MAX_ID?this.lastId=0:this.lastId++}while(this.idToCallback.hasOwnProperty(this.lastId));return this.lastId},_patchMethods(){if(n.top!==n)return n.setSafeInterval=n.setInterval,n.clearSafeInterval=n.clearInterval,n.setSafeTimeout=n.setTimeout,void(n.clearSafeTimeout=n.clearTimeout);n.setSafeInterval=(e,r,...n)=>{const i=this._generateId();return this.idToCallback[i]={cb:e,p:n,isInterval:!0},t.injection.sendEvent("timer.setInterval",{id:i,time:r}),i},n.clearSafeInterval=e=>{this.idToCallback.hasOwnProperty(e)&&(delete this.idToCallback[e],t.injection.sendEvent("timer.clearInterval",{id:e}))},n.setSafeTimeout=(e,r,...n)=>{const i=this._generateId();return this.idToCallback[i]={cb:e,p:n},t.injection.sendEvent("timer.setTimeout",{id:i,time:r}),i},n.clearSafeTimeout=e=>{this.idToCallback.hasOwnProperty(e)&&(delete this.idToCallback[e],t.injection.sendEvent("timer.clearTimeout",{id:e}))}},onTimer(e,r){if(!e)return;const i=this.idToCallback[e];if(!i)return void("interval"===r&&t.injection.sendEvent("timer.clearInterval",{id:e}));let{p:s,cb:o}=i;if(i.isInterval||delete this.idToCallback[e],"string"==typeof o)try{o=new Function(o)}catch{}"function"==typeof o&&o.apply(n,s)}}})(),(()=>{const{$engine:t,$utils:r}=e;t.trapper={init(){n===i&&(this._grabbing=!1,this._trapper=null,this._target=null,this._targetLocked=!1,this._targetBeforeHover=null,this._hoverScrollTimeout=null,this._toggleWhenStateChanges(),this._onClick=this._onClick.bind(this),this._onScroll=this._onScroll.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onKeyDown=this._onKeyDown.bind(this))},cancel(){this._unlockTarget()},hover(e){if(this._setupOnce(),this._targetBeforeHover||(this._targetBeforeHover=this._target),this._setTarget(e),v(this._hoverScrollTimeout),!e)return;const t=this._getRect(e);(t.x<0||t.x>n.innerWidth||t.y<0||t.y>n.innerHeight)&&(this._hoverScrollTimeout=N((()=>{e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}),300))},unhover(){this._target&&(v(this._hoverScrollTimeout),this._setTarget(this._targetBeforeHover),this._targetBeforeHover=null)},async computeSelector(e){const r=t.locatorAi.computeAiLocator(e.container);return"element"!==e.type&&r.selector.push({$parse:e.type,at:e.at}),r.selector},_toggleWhenStateChanges(){t.state.observe((e=>{const t=e.trapperGrabbing;this._grabbing!==t&&this._toggle(t)}))},_toggle(e){this._setupOnce(),this._grabbing!==e&&(this._grabbing=e,this._toggleTrapperStyles(e),this._togglePageInteractions(e),this._toggleHoverActiveStates(e),this._toggleGlobalListeners(e),e?(this._targetLocked=!1,w.activeElement.blur()):(this._setTarget(null),this._targetBeforeHover=null,v(this._hoverScrollTimeout)))},_setupOnce(){if(this._trapper)return;const e=w.querySelector("__hrp__");this._trapper=w.createElement("div"),this._trapper.classList.add("HrpTrapper"),this._trapper.hidden=!0,e.append(this._trapper)},_toggleTrapperStyles(e){w.documentElement.classList.toggle("HrpTrapper--enabled",!!e)},_togglePageInteractions(e){this._preventEvent||(this._preventEvent=e=>{try{e.preventDefault(),e.stopPropagation()}catch{}});const t=["click","focus","keydown","keyup","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","pointercancel","pointerdown","pointerenter","pointerleave","pointermove","pointerout","pointerover","pointerup"];for(const r of t)e?n.addEventListener(r,this._preventEvent,!0):n.removeEventListener(r,this._preventEvent,!0)},_toggleHoverActiveStates(e){this._selectorTextSymbol||(this._selectorTextSymbol=Symbol("selectorText"));const t=this._extractAllCssRules();for(const r of t)if(e){const e=r.selectorText.includes(":hover"),t=r.selectorText.includes(":active");if(!e&&!t)continue;r[this._selectorTextSymbol]=r.selectorText,r.selectorText=r.selectorText.replaceAll(":hover",":not(:hover):hover").replaceAll(":active",":not(:active):active")}else r[this._selectorTextSymbol]&&(r.selectorText=r[this._selectorTextSymbol],delete r[this._selectorTextSymbol])},_toggleGlobalListeners(e){e?(n.addEventListener("click",this._onClick,!0),n.addEventListener("scroll",this._onScroll,!0),n.addEventListener("mousemove",this._onMouseMove,!0),n.addEventListener("keydown",this._onKeyDown,!0)):(n.removeEventListener("click",this._onClick,!0),n.removeEventListener("scroll",this._onScroll,!0),n.removeEventListener("mousemove",this._onMouseMove,!0),n.addEventListener("keydown",this._onKeyDown,!0))},_onMouseMove(e){if(this._targetLocked)return;const t=this._findTarget(e);this._target!==t&&this._setTarget(t)},_onScroll(e){},_onClick(e){if(this._targetLocked)return void this._unlockTarget();const r=this._findTarget(e);if(!r)return;this._setTarget(r);const n=w.documentElement.scrollLeft,i=w.documentElement.scrollTop,{x:s,y:o,width:a,height:l}=this._getRect(this._target);this._targetLocked=!0,t.injection.sendEvent("trapper.targetLocked",{text:this._getElementText(this._target),element:this._target,mouseX:n+e.clientX,mouseY:n+e.clientY,rect:{top:i+o-8,left:n+s-8,right:n+s+a+8,bottom:i+o+l+8}})},_onKeyDown(e){"Escape"===e.key&&(this._targetLocked?this._unlockTarget():t.state.transaction((e=>{e.frameOpen=!0,e.trapperGrabbing=!1})))},_setTarget(e){if(e===this._target)return;if(this._target=e,this._trapper.hidden=!e,!e||!e.getBoundingClientRect)return;const t=e.getBoundingClientRect(),r=w.documentElement.scrollTop,n=w.documentElement.scrollLeft;this._trapper.style.top=r+t.y-5+"px",this._trapper.style.left=n+t.x-5+"px",this._trapper.style.width=`${t.width+10}px`,this._trapper.style.height=`${t.height+10}px`},_unlockTarget(){this._setTarget(null),this._targetLocked=!1},_extractAllCssRules(){const e=[],t=n=>{if(n.selectorText)return void e.push(n);const i=r.noThrow((()=>n.cssRules));if(i)for(const e of i)t(e)};for(const e of w.styleSheets)t(e);return e},_findTarget(e){const t=e.clientX,r=e.clientY;let n;if(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey){n=w.elementsFromPoint(t,r).map((e=>({element:e,area:this._getElementArea(e)}))).reduce(((e,t)=>e.area>t.area?t:e))?.element}else n=w.elementFromPoint(t,r);if("step-paste"===this._grabbing){const e=["[contenteditable]","input:not([type])",'input[type="text"]','input[type="email"]','input[type="search"]',"textarea"].join(", ");if(n=n.closest(e),!n)return null}if(this._shouldIgnoreTarget(n)){const e=[],i=Symbol(),s=Symbol();for(;;){const o=n.style;if(n[i]=o.getPropertyValue("pointer-events"),n[s]=o.getPropertyPriority("pointer-events"),n.style.setProperty("pointer-events","none","important"),e.push(n),n=w.elementFromPoint(t,r),n===w.body)break;if(!this._shouldIgnoreTarget(n))break}for(const t of e)t.style.setProperty("pointer-events",t[i],t[s])}return n},_shouldIgnoreTarget(e){return!e||(!!this._isEmptyElement(e)||!t.inspector.isVisible(e))},_getRect:e=>e.getBBox?e.getBBox():e.getBoundingClientRect(),_getElementText(e){let t=T(e,"::before").content,r=T(e,"::after").content;"none"===t&&(t=""),"none"===r&&(r="");let n=e.innerText||e.value||e.placeholder;return n=[t,n,r].filter(Boolean).join(" "),n||(n=e.getAttribute("src")||e.getAttribute("href")||""),n},_getElementArea(e){const t=this._getRect(e);return t.width*t.height},_isEmptyElement(e){const t=e.tagName.toLowerCase(),r=e.textContent.trim(),n=T(e).getPropertyValue("background-image"),i="img"===t?e.getAttribute("src"):null,s=0===r.length,o="none"===n,a=null===i||0===i.length,l="input"===t,c="select"===t,h="textarea"===t,m=e.contentEditable;return s&&o&&a&&!(l||c||h||("true"===m||""===m))&&!(e instanceof d)}}})(),(()=>{const{$engine:t,$utils:r}=e;t.waiter={async wait(e,t={}){if("number"==typeof e)return await new Promise((t=>{setSafeTimeout(t,e)})),{result:!0,durationMs:e};t=this._normalizeOptions(t);const{timeout:r,polling:n}=t,i=Date.now(),s="string"==typeof e?this._checkString:"function"==typeof e?this._checkCondition:"function"===e?.__$ht?this._checkFunctionString:"object"==typeof e?this._checkLocator:()=>{};do{const o=await s(e,t);if(void 0!==o)return{result:o,durationMs:Date.now()-i};const a=i+r-Date.now()-20,l=Math.max(20,Math.min(n,a));await new Promise((e=>{setSafeTimeout(e,l>0?l:n)}))}while(Date.now()-i<=r)},_normalizeOptions:e=>({timeout:15e3,polling:100,contentType:"innerText",args:[],min:1,max:null,...e}),async _checkCondition(e,{args:n,not:i}){const s=await t.page.evaluate(e,n);if(i?!s:!!s)return r.is.undefined(s)?null:s},async _checkFunctionString(e,{args:n,not:i}){e=e.body;const s=await t.page.evaluate(e,n);if(i?!s:!!s)return r.is.undefined(s)?null:s},async _checkString(e,{contentType:n,min:i,max:s,not:o}){let a=await t.page.content(null,{contentType:n});a=r.occurrences.string(a,e);let l=(null===i||a>=i)&&(null===s||a<=s);if(o&&(l=!l),l)return r.is.undefined(a)?null:a},async _checkLocator(e,{min:n,max:i,not:s}){const o=(await t.page.query(e,{m:!0})).length;let a=(null===n||o>=n)&&(null===i||o<=i);if(s&&(a=!a),a)return r.is.undefined(o)?null:o}}})(),(()=>{const{$gdocs:t}=e;t.isDocsUrl=e=>e.startsWith("https://docs.google.com/document/d/")})(),(()=>{const{$gdocs:t}=e;t.controller={isDocsPage:()=>t.isDocsUrl(x.href),getText(){if(!this.isDocsPage())return null;try{return this._getText()}catch(e){return t.error("failed to get text",e),""}},getSelectedText(){return this.isDocsPage()?"N/A for Google Docs":null},pasteText(e){if(this.isDocsPage())try{this._pasteText(e)}catch(e){t.error("failed to paste text",e)}},_getText(){try{const e='script[type="text/javascript"], script[nonce]';return Array.from(w.querySelectorAll(e)).map((e=>e.innerText?.trim())).filter((e=>e&&e.startsWith("DOCS_modelChunk = "))).map((e=>e.split('"},{"ty"')[0])).map((e=>e.split('"s":"')[1])).map((e=>e.replaceAll("\\n","\n"))).join("\n")}catch{return w.body.innerText}},_pasteText(e){const t=w.querySelector(".docs-texteventtarget-iframe").contentWindow.document.querySelector("[contenteditable=true]"),r=new ClipboardEvent("paste",{clipboardData:new DataTransfer,bubbles:!0});r.clipboardData.setData("text/plain",e),t.focus(),t.dispatchEvent(r)}}})(),(()=>{const{$startup:t,$engine:r,$capture:n}=e;t.engineController={async init(){await t.controller.waitInit(),await n.controller.init(),await r.injection.init(),t.logDev("nj-engine ready")}},t.engineController.init()})()})();