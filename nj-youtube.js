(()=>{let t;(()=>{const e="__app_hrp",i="production",s=!1;if(t=globalThis[e],t)return;const o={name:e,env:i,get:t=>t in o?o[t]:null,...JSON.parse('{"version":"11.4.0"}')},r=function t(e){const i=e===o,n=i&&s,r={},h=t=>Object.assign(e,t),d=new Proxy(e,{get(s,o){if("assign"===o)return h;if(i&&!String(o).startsWith("$"))return e[o];if(!(o in e)){if(e[o]={},i){const t=a.bind(null,"log",o,!1),i=a.bind(null,"log",o,!0),s=a.bind(null,"warn",o,!1),n=a.bind(null,"warn",o,!0),r=a.bind(null,"error",o,!1),h=a.bind(null,"error",o,!0),d=l.bind(null,o);Object.defineProperties(e[o],{log:{get:()=>t},logDev:{get:()=>i},warn:{get:()=>s},warnDev:{get:()=>n},error:{get:()=>r},errorDev:{get:()=>h},Error:{get:()=>d}})}r[o]=t(e[o]),n&&(globalThis[o]=e[o])}return o in r?r[o]:e[o]},set:(t,i,s)=>(e[i]=s,r[i]=s,n&&(globalThis[i]=e[i]),!0)});return d}(o);function a(t,e,i,...s){if(i)return;const[o,r,a]=function(t){let e=0;t.split("").forEach(((i,s)=>{e=t.charCodeAt(s)+((e<<5)-e)}));return[(16711680&e)>>16,(65280&e)>>8,255&e]}(e);n[t](`%c[${e}]`,`color: rgb(${o}, ${r}, ${a})`,...s)}function l(t,e,...i){return i.length>0&&a("error",t,!1,e,...i),new Error(`[${t}] ${e}`)}globalThis[e]=r,t=r})();const e=t=>{const e=globalThis.__hrp_globals||{},i={},s=(t,e)=>"function"==typeof e&&/^[a-z]/.test(t);return new Proxy(t,{get(o,n){let r=e[n]||t[n];return s(n,r)&&(i[n]??=r.bind(t),r=i[n]),r},set:(e,o,n)=>(t[o]=n,s(o,n)&&(i[o]=n.bind(t)),!0)})},i=t=>{try{return s[t]}catch{return globalThis[t]}},s=e(globalThis),o=globalThis.top===globalThis?s:e(globalThis.top),n=i("logger")||i("console"),r=(i("Audio"),i("Blob"),i("CSSStyleSheet"),i("CanvasRenderingContext2D"),i("CustomEvent"),i("DOMParser"),i("Event"),i("File"),i("FileReader"),i("HTMLAnchorElement"),i("HTMLElement"),i("HTMLImageElement"),i("HTMLVideoElement"),i("Headers"),i("Image"),i("IntersectionObserver"),i("MouseEvent"),i("MutationObserver")),a=(i("Node"),i("NodeFilter"),i("NodeList"),i("Request"),i("ResizeObserver"),i("Response"),i("SVGElement"),i("URL"),i("WebSocket"),i("Worker"),i("XMLHttpRequest"),i("XMLSerializer"),i("XPathResult"),i("alert"),i("atob"),i("btoa"),i("chrome"),i("clearInterval"),i("clearTimeout"),i("document"));i("fetch"),i("getComputedStyle"),i("getSelection"),i("history"),i("indexedDB"),i("location"),i("navigator"),i("parent"),i("requestAnimationFrame"),i("screen"),i("setInterval"),i("setTimeout");let l=null;try{l=i("localStorage")}catch{}let h=null;try{h=i("sessionStorage")}catch{}(()=>{const{$yousummary:e,$bus:i}=t;e.controller={init(){o.self===self&&(this.startObserver=this.startObserver.bind(this),this.stopObserver=this.stopObserver.bind(this),this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.appendSummary=this.appendSummary.bind(this),i.on("yousummary.append-summary",this.appendSummary),a.hidden?this.stopObserver():this.startObserver(),a.addEventListener("visibilitychange",this.handleVisibilityChange))},appendSummary(t){this.summary?.local?this.summary.content+="\n\n"+t:this.summary={local:!0,content:t};this.computePoi(this.summary)&&(this.summary.content=t),this.applyPosition()},startObserver(){if(this.tooltip||this.observer||a.hidden)return;this.observer=new r((t=>{if(!t?.some((t=>t.addedNodes.length)))return;const e=a.querySelector("#ytd-player .ytp-tooltip .ytp-tooltip-edu > span");if(!e)return;const i=a.querySelector("ytd-watch-flexy");if(!i)return;const s=a.querySelector(".ytp-tooltip-text");e.__ys_patched||(e.__ys_patched=!0,this.nodeTooltip=e,this.nodeVideo=i,this.nodePosition=s,this.patchTooltip())})),this.observer.observe(a.documentElement,{childList:!0,subtree:!0})},stopObserver(){this.observer&&(this.observer.disconnect(),this.observer=null)},handleVisibilityChange(){a.hidden?this.stopObserver():this.startObserver()},patchTooltip(){this.stopObserver(),a.removeEventListener("visibilitychange",this.handleVisibilityChange);const t=this.nodeTooltip.parentElement;t.removeChild(this.nodeTooltip);const e=a.createElement("style");e.innerText="#poi{max-width:236px;margin-right:7px;border-radius:6px;padding:4px 6px}.ytp-fullscreen #poi{margin-right:9px;max-width:358px}#poi.loaded{text-align:left;background:rgba(0,0,0,.5);margin-bottom:4px}#poi .poi-content{font-weight:400;margin-top:8px}#poi .poi-hidden{display:none}",t.appendChild(e),this.poi=a.createElement("div"),this.poi.id="poi";const i=a.createElement("div");i.classList.add("poi-title"),this.poi.appendChild(i);const s=a.createElement("div");s.classList.add("poi-content"),this.poi.appendChild(s),t.appendChild(this.poi),this.watchPositionChange(),this.watchVidChanges()},watchVidChanges(){new r((t=>{const e=t.find((t=>"attributes"===t.type&&"video-id"===t.attributeName));if(!e)return;const i=e.target.getAttribute("video-id");this.loadSummary(i)})).observe(this.nodeVideo,{attributes:!0}),this.loadSummary(this.nodeVideo.getAttribute("video-id"))},watchPositionChange(){new r((t=>{const e=t.find((t=>"childList"===t.type));if(!e)return;const i=e.target.textContent.trim();this.updatePosition(i)})).observe(this.nodePosition,{childList:!0,subtree:!0}),this.updatePosition(this.nodePosition.textContent)},updatePosition(t){t&&this.positionText!==t&&(this.positionText=t,t=t.split(":"),this.position=(parseInt(t.at(-1),10)||0)+60*(parseInt(t.at(-2),10)||0)+3600*(parseInt(t.at(-3),10)||0),this.applyPosition())},async loadSummary(t){this.summary=null,this.applyPosition();const e=await i.send("yousummary.get-summary",t);e&&this.appendSummary(e)},computePoi(t){const e=/^\s*-\s+/,i=(t.content||"").split("\n"),s=[];let o=null;for(let t of i){""===t&&(t="\n");const i=/^\s*(- )?\[(?<hour>\d\d?:)?(?<minute>\d\d?):(?<second>\d\d?)](?<url>\(.+\))\s?(?<text>.+)/gm.exec(t);i?(o&&s.push(o),o={ts:0,text:""},o.ts=3600*(parseInt(i.groups.hour)||0)+60*(parseInt(i.groups.minute)||0)+(parseInt(i.groups.second)||0),o.text=i.groups.text):o&&(t=t.replace(e," â€¢ "),o.text+=t+"\n")}o&&s.push(o),s.forEach((t=>t.text=t.text.trim()));let n=0,r=Number.MAX_SAFE_INTEGER;for(let t=s.length-1;t>=0;t--){if(s[t].ts>r){n=t+1;break}r=s[t].ts}return t.poi=s.slice(n),n>0},applyPosition(){if(!this.poi)return;const t=this.summary?.poi?.findLast((t=>t.ts<=this.position));if(t){const e=t.text.split("\n"),i=e[0];this.poi.childNodes[0].innerText=i;const s=e.slice(1).join("\n").trim();this.poi.childNodes[1].innerText=s,this.poi.classList.add("loaded")}else this.poi.childNodes[0].innerText="Summarize with HARPA to show key points",this.poi.childNodes[1].innerText="",this.poi.classList.remove("loaded");this.poi.childNodes[1].classList.toggle("poi-hidden",!this.poi.childNodes[1].innerText)}}})(),(()=>{const{$startup:e,$yousummary:i}=t;e.youtubeController={async init(){await e.controller.waitInit(),await i.controller.init(),e.logDev("nj-youtube ready")}},e.youtubeController.init()})()})();